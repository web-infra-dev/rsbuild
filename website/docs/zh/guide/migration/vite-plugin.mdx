# Vite 插件

本章节介绍如何将 Vite 插件迁移到 Rsbuild 插件。

## 现有插件

在迁移一个 Vite 插件之前，建议先检查 Rsbuild 生态中是否存在对应的插件，你可以通过以下页面来查找：

- [Rsbuild 官方插件](/plugins/list)
- [Rsbuild 社区插件](https://github.com/web-infra-dev/awesome-rspack?tab=readme-ov-file#rsbuild-plugins)

## 插件 hooks

Rsbuild 的插件 API 覆盖了大部分的 Vite 和 Rollup 插件 hooks，例如：

| Vite 插件 hooks      | Rsbuild 插件 API                                                                                                       |
| -------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| `resolveId`          | [resolve](/plugins/dev/core#apiresolve)                                                                                |
| `transform`          | [transform](/plugins/dev/core#apitransform)                                                                            |
| `config`             | [modifyRsbuildConfig](/plugins/dev/hooks#modifyrsbuildconfig)                                                          |
| `configResolved`     | [getNormalizedConfig](/plugins/dev/core#apigetnormalizedconfig)                                                        |
| `configEnvironment`  | [modifyEnvironmentConfig](/plugins/dev/hooks#modifyenvironmentconfig)                                                  |
| `configureServer`    | [onBeforeStartDevServer](/plugins/dev/hooks#onbeforestartdevserver)                                                    |
| `buildStart`         | [onBeforeBuild](/plugins/dev/hooks#onbeforebuild), [onBeforeStartDevServer](/plugins/dev/hooks#onbeforestartdevserver) |
| `buildEnd`           | [onAfterBuild](/plugins/dev/hooks#onafterbuild), [onCloseDevServer](/plugins/dev/hooks#onclosedevserver)               |
| `closeBundle`        | [onCloseBuild](/plugins/dev/hooks#onclosebuild), [onCloseDevServer](/plugins/dev/hooks#onclosedevserver)               |
| `transformIndexHtml` | [modifyHTML](/plugins/dev/hooks#modifyhtml), [modifyHTMLTags](/plugins/dev/hooks#modifyhtmltags)                       |

请参考 [插件系统](/plugins/dev/index) 文档来了解更多。

## `config` 钩子

Rsbuild 与 Vite 提供了不同的配置项，在迁移 Vite 插件时，需要根据 Rsbuild 的配置项进行调整。

例如，将 Vite 的 `define` 选项替换为 Rsbuild 的 [source.define](/config/source/define) 选项。

- Vite 插件：

```ts title="vitePlugin.ts"
const vitePlugin = {
  name: 'my-plugin',
  config: (config) => {
    config.define = {
      ...config.define,
      FOO: '"foo"',
    };
  },
};
```

- Rsbuild 插件：

```ts title="rsbuildPlugin.ts"
const rsbuildPlugin = {
  name: 'my-plugin',
  setup(api) {
    api.modifyRsbuildConfig((config) => {
      config.source ||= {};
      config.source.define = {
        ...config.source.define,
        FOO: '"foo"',
      };
    });
  },
};
```

:::tip
查看 [配置迁移](/guide/migration/vite#配置迁移) 了解如何将 Vite 的配置迁移到 Rsbuild。
:::

## `transformIndexHtml` 钩子

Vite 的 `transformIndexHtml` 钩子对应了 Rsbuild 的两个钩子：

- [modifyHTML](/plugins/dev/hooks#modifyhtml)：用于修改 HTML 内容
- [modifyHTMLTags](/plugins/dev/hooks#modifyhtmltags)：用于修改 HTML 标签

下面一个是替换 HTML 标题的示例。

- Vite 插件：

```ts title="vitePlugin.ts"
const htmlPlugin = () => {
  return {
    name: 'html-plugin',
    transformIndexHtml(html) {
      return html.replace(
        /<title>(.*?)<\/title>/,
        `<title>Title replaced!</title>`,
      );
    },
  };
};
```

- Rsbuild 插件：

```ts title="rsbuildPlugin.ts"
const rsbuildPlugin = {
  name: 'html-plugin',
  setup(api) {
    api.modifyHTML((html) => {
      return html.replace(
        /<title>(.*?)<\/title>/,
        `<title>Title replaced!</title>`,
      );
    });
  },
};
```
