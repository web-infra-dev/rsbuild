# Create React App

æœ¬ç« èŠ‚ä»‹ç»å¦‚ä½•å°† [Create React App](https://github.com/facebook/create-react-app)ï¼ˆç®€ç§° CRAï¼‰æˆ– [CRACO](https://craco.js.org/) é¡¹ç›®è¿ç§»åˆ° Rsbuildã€‚

:::tip CRA eject
å¦‚æœä½ çš„é¡¹ç›®å·²ç»æ‰§è¡Œäº† CRA çš„ `eject` å‘½ä»¤ï¼Œé‚£ä¹ˆæœ¬æ–‡æ¡£çš„å¤§éƒ¨åˆ†å†…å®¹å°†ä¸å†é€‚ç”¨ã€‚

CRA é¡¹ç›®åœ¨ eject åï¼Œæ›´è¿‘ä¼¼äºç›´æ¥ä½¿ç”¨ webpack çš„é¡¹ç›®ï¼Œå› æ­¤ä½ å¯ä»¥å‚è€ƒ [webpack è¿ç§»æŒ‡å—](/guide/migration/webpack)ã€‚

:::

## å®‰è£…ä¾èµ–

é¦–å…ˆä½ éœ€è¦æŠŠ CRA çš„ npm ä¾èµ–æ›¿æ¢ä¸º Rsbuild çš„ä¾èµ–ã€‚

import { PackageManagerTabs } from '@theme';

- ç§»é™¤ CRA çš„ä¾èµ–ï¼š

<PackageManagerTabs command="remove react-scripts" />

> å¯¹äºä½¿ç”¨ CRACO çš„é¡¹ç›®ï¼Œä½ è¿˜å¯ä»¥ç§»é™¤ `@craco/craco` ä¾èµ–ã€‚

- å®‰è£… Rsbuild çš„ä¾èµ–ï¼š

<PackageManagerTabs command="add @rsbuild/core @rsbuild/plugin-react -D" />

## æ›´æ–° npm scripts

ä¸‹ä¸€æ­¥ï¼Œä½ éœ€è¦æŠŠ package.json ä¸­çš„ npm scripts æ›´æ–°ä¸º Rsbuild çš„ CLI å‘½ä»¤ã€‚

```diff title="package.json"
{
  "scripts": {
-   "start": "react-scripts start",
-   "build": "react-scripts build",
-   "eject": "react-scripts eject"
+   "start": "rsbuild dev",
+   "build": "rsbuild build",
+   "preview": "rsbuild preview"
  }
}
```

:::tip
Rsbuild æœªé›†æˆæµ‹è¯•æ¡†æ¶ï¼Œå› æ­¤æ²¡æœ‰æä¾›ç”¨äºæ›¿æ¢ `react-scripts test` çš„å‘½ä»¤ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ Jest æˆ– Vitest ç­‰æµ‹è¯•æ¡†æ¶ã€‚ä½ å¯ä»¥å‚è€ƒ [Rsbuild react-jest](https://github.com/rspack-contrib/rspack-examples/tree/main/rsbuild/react-jest) ç¤ºä¾‹é¡¹ç›®è¿›è¡Œé…ç½®ã€‚
:::

## åˆ›å»ºé…ç½®æ–‡ä»¶

åœ¨ package.json çš„åŒçº§ç›®å½•ä¸‹åˆ›å»º Rsbuild çš„é…ç½®æ–‡ä»¶ `rsbuild.config.ts`ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```ts title="rsbuild.config.ts"
import { defineConfig } from '@rsbuild/core';
import { pluginReact } from '@rsbuild/plugin-react';

export default defineConfig({
  plugins: [pluginReact()],
});
```

## HTML æ¨¡æ¿

CRA é»˜è®¤ä½¿ç”¨ `public/index.html` æ–‡ä»¶ä½œä¸º HTML æ¨¡æ¿ã€‚åœ¨ Rsbuild ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ [html.template](/config/html/template) æ¥æŒ‡å®š HTML æ¨¡æ¿ï¼š

```ts title="rsbuild.config.ts"
export default defineConfig({
  html: {
    template: './public/index.html',
  },
});
```

åœ¨ HTML æ¨¡æ¿ä¸­ï¼Œå¦‚æœä½¿ç”¨äº† CRA çš„ `%PUBLIC_URL%` å˜é‡ï¼Œè¯·æ›¿æ¢ä¸º Rsbuild çš„ [assetPrefix å˜é‡](/config/html/template-parameters)ï¼Œå¹¶ä½¿ç”¨æ–œæ è¿›è¡Œè¿æ¥ï¼š

```diff
-  <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
+  <link rel="icon" href="<%= assetPrefix %>/favicon.ico" />
```

è¿™æ ·å°±å®Œæˆäº†ä» CRA åˆ° Rsbuild çš„åŸºæœ¬è¿ç§»ï¼Œæ­¤æ—¶ä½ å¯ä»¥æ‰§è¡Œ `npm run start` å‘½ä»¤æ¥å°è¯•å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚

## æ„å»ºäº§ç‰©ç›®å½•

CRA é»˜è®¤ä¼šå°†æ„å»ºäº§ç‰©è¾“å‡ºåˆ° `build` ç›®å½•ï¼Œè€Œ Rsbuild çš„é»˜è®¤æ„å»ºäº§ç‰©ç›®å½•ä¸º `dist`ã€‚

ä½ å¯ä»¥é…ç½® Rsbuild çš„ [output.distPath.root](/config/output/dist-path) é€‰é¡¹ï¼Œå°†ç›®å½•ä¿®æ”¹ä¸º `build`ï¼Œä¸ CRA ä¿æŒä¸€è‡´ï¼š

```ts title="rsbuild.config.ts"
export default {
  output: {
    distPath: {
      root: 'build',
    },
  },
};
```

> æ›´å¤šç»†èŠ‚è¯·å‚è€ƒ[æ„å»ºäº§ç‰©ç›®å½•](/guide/basic/output-files)ç« èŠ‚ã€‚

## ä½¿ç”¨ CSS é¢„å¤„ç†å™¨

Rsbuild é€šè¿‡æ’ä»¶æ¥æ”¯æŒ Sass å’Œ Less ç­‰ CSS é¢„å¤„ç†å™¨ï¼Œä½¿ç”¨æ–¹å¼è¯·å‚è€ƒï¼š

- [Sass æ’ä»¶](/plugins/list/plugin-sass)
- [Less æ’ä»¶](/plugins/list/plugin-less)
- [Stylus æ’ä»¶](/plugins/list/plugin-stylus)

## ä½¿ç”¨ SVGR

å¦‚æœä½ ä½¿ç”¨äº† CRA çš„ "SVG è½¬ React ç»„ä»¶" åŠŸèƒ½ï¼ˆå³ [SVGR](https://react-svgr.com/)ï¼‰ï¼Œé‚£ä¹ˆè¿˜éœ€è¦å®‰è£… Rsbuild çš„ SVGR æ’ä»¶ã€‚

æ¯”å¦‚ä½¿ç”¨äº†ä»¥ä¸‹ç”¨æ³•ï¼š

```jsx
import { ReactComponent as Logo } from './logo.svg';

const App = () => (
  <div>
    <Logo />
  </div>
);
```

åªéœ€è¦å®‰è£…å’Œæ³¨å†Œ `@rsbuild/plugin-svgr` å³å¯ï¼š

```ts title="rsbuild.config.ts"
import { pluginSvgr } from '@rsbuild/plugin-svgr';

export default {
  plugins: [pluginSvgr({ mixedImport: true })],
};
```

è¯·å‚è€ƒ [SVGR æ’ä»¶](/plugins/list/plugin-svgr) æ–‡æ¡£äº†è§£å¦‚ä½•åœ¨ Rsbuild ä¸­ä½¿ç”¨ SVGRã€‚

## é…ç½®è¿ç§»

ä»¥ä¸‹æ˜¯ [CRA é…ç½®](https://create-react-app.dev/docs/advanced-configuration/)å¯¹åº”çš„ Rsbuild é…ç½®ï¼š

| CRA                     | Rsbuild                                                                                         |
| ----------------------- | ----------------------------------------------------------------------------------------------- |
| HOST                    | [server.host](/config/server/host)                                                              |
| PORT                    | [server.port](/config/server/port)                                                              |
| HTTPS                   | [server.https](/config/server/https)                                                            |
| WDS_SOCKET_HOST         | [dev.client.host](/config/dev/client)                                                           |
| WDS_SOCKET_PATH         | [dev.client.path](/config/dev/client)                                                           |
| WDS_SOCKET_PORT         | [dev.client.port](/config/dev/client)                                                           |
| PUBLIC_URL              | [dev.assetPrefix](/config/dev/asset-prefix) / [output.assetPrefix](/config/output/asset-prefix) |
| BUILD_PATH              | [output.distPath](/config/output/dist-path)                                                     |
| GENERATE_SOURCEMAP      | [output.sourceMap](/config/output/source-map)                                                   |
| IMAGE_INLINE_SIZE_LIMIT | [output.dataUriLimit](/config/output/data-uri-limit)                                            |
| FAST_REFRESH            | [dev.hmr](/config/dev/hmr)                                                                      |
| TSC_COMPILE_ON_ERROR    | [@rsbuild/plugin-type-check](https://github.com/rspack-contrib/rsbuild-plugin-type-check)       |

è¯´æ˜ï¼š

- ä¸Šè¿°è¡¨æ ¼å°šæœªè¦†ç›–åˆ° CRA çš„æ‰€æœ‰é…ç½®ï¼Œæ¬¢è¿è¡¥å……ã€‚

## ç¼–è¯‘ node_modules

CRA é»˜è®¤ä¼šä½¿ç”¨ Babel ç¼–è¯‘ node_modules ä¸­çš„ä¾èµ–ï¼Œä½† Rsbuild åˆ™ä¸ä¼šï¼Œè¿™æ˜¯ä¸ºäº†é¿å…äºŒæ¬¡ç¼–è¯‘å¸¦æ¥çš„æ€§èƒ½æŸè€—å’Œæ½œåœ¨çš„ç¼–è¯‘é”™è¯¯ã€‚

å¦‚æœä½ éœ€è¦å¤„ç† node_modules ä¸­ä¾èµ–å¼•èµ·çš„è¯­æ³•å…¼å®¹æ€§é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ [source.include](/config/source/include#ç¼–è¯‘-node_modules) é…ç½®é¡¹æ¥ç¼–è¯‘ node_modulesã€‚

```ts title="rsbuild.config.ts"
export default {
  source: {
    // ç¼–è¯‘æ‰€æœ‰ JS æ–‡ä»¶å¹¶æ’é™¤ core-js
    include: [{ not: /[\\/]core-js[\\/]/ }],
  },
};
```

## ç¯å¢ƒå˜é‡

CRA é»˜è®¤ä¼šå°† `REACT_APP_` å¼€å¤´çš„ç¯å¢ƒå˜é‡æ³¨å…¥åˆ° client ä»£ç ä¸­ï¼Œè€Œ Rsbuild é»˜è®¤ä¼šæ³¨å…¥ `PUBLIC_` å¼€å¤´çš„ç¯å¢ƒå˜é‡ï¼ˆå‚è€ƒ [public å˜é‡](/guide/advanced/env-vars#public-å˜é‡)ï¼‰ã€‚

ä¸ºäº†å…¼å®¹ CRA çš„è¡Œä¸ºï¼Œä½ å¯ä»¥æ‰‹åŠ¨è°ƒç”¨ Rsbuild æä¾›çš„ [loadEnv](/api/javascript-api/core#loadenv) æ–¹æ³•æ¥è¯»å– `REACT_APP_` å¼€å¤´çš„ç¯å¢ƒå˜é‡ï¼Œå¹¶é€šè¿‡ [source.define](/config/source/define) é…ç½®é¡¹æ³¨å…¥åˆ° client ä»£ç ä¸­ã€‚

```ts title="rsbuild.config.ts"
import { defineConfig, loadEnv } from '@rsbuild/core';

const { publicVars } = loadEnv({ prefixes: ['REACT_APP_'] });

export default defineConfig({
  source: {
    define: publicVars,
  },
});
```

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒCRA å…è®¸åœ¨ä»£ç ä¸­è®¿é—®å®Œæ•´çš„ `process.env` å¯¹è±¡ï¼Œä¹Ÿå…è®¸å¯¹ `process.env` è¿›è¡Œè§£æ„ã€‚è€Œ Rsbuild å‡ºäºåŒ…ä½“ç§¯å’Œå®‰å…¨çš„è€ƒè™‘ï¼Œå¹¶æ²¡æœ‰æ³¨å…¥å®Œæ•´çš„ `process.env` å¯¹è±¡ã€‚

```ts title="src/index.js"
// CRA ä¸­å¯ä»¥è¿™æ ·è®¿é—®
const { PUBLIC_URL } = process.env;
console.log(PUBLIC_URL);
console.log(process.env);
```

åœ¨ Rsbuild ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ [source.define](/config/source/define) é…ç½®é¡¹è®¾ç½® `process.env`ï¼Œè¯»å– `loadEnv` æ–¹æ³•è¿”å›çš„ `rawPublicVars`ï¼Œæ¥å…è®¸ä»¥ä¸Šç”¨æ³•ï¼š

```ts title="rsbuild.config.ts"
import { defineConfig, loadEnv } from '@rsbuild/core';

const { publicVars, rawPublicVars } = loadEnv({ prefixes: ['REACT_APP_'] });

export default defineConfig({
  source: {
    define: {
      ...publicVars,
      'process.env': JSON.stringify(rawPublicVars),
    },
  },
});
```

## å¼•ç”¨æœªçŸ¥èµ„æº

åœ¨ CRA ä¸­ï¼Œå¦‚æœä½ å¼•ç”¨äº†ä¸€ä¸ªæ„å»ºå·¥å…·æ— æ³•è¯†åˆ«çš„èµ„æºï¼ŒCRA é»˜è®¤ä¼šå°†è¯¥æ–‡ä»¶è¾“å‡ºåˆ° `build/static/media` ç›®å½•ä¸‹ï¼Œæ¯”å¦‚ `document.pdf` æ–‡ä»¶ï¼š

```js title="index.js"
import document from './document.pdf';
```

åœ¨ Rsbuild ä¸­ï¼Œé‡åˆ°æ— æ³•è¯†åˆ«çš„èµ„æºæ—¶ï¼ŒRsbuild ä¼šè¾“å‡ºæŠ¥é”™æ—¥å¿—ï¼Œç±»ä¼¼äºï¼š

```text
You may need an appropriate loader to handle this file type.
```

ä¸ºäº†è§£å†³è¯¥é”™è¯¯ï¼Œä½ å¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š

- ä½¿ç”¨ [tools.rspack](/config/tools/rspack) é…ç½®ä¸€ä¸ªåˆé€‚çš„ loader æ¥å¤„ç†è¯¥ç±»å‹çš„èµ„æºã€‚
- ä½¿ç”¨ [tools.rspack](/config/tools/rspack) é…ç½® [asset modules](https://rspack.dev/guide/features/asset-module) è§„åˆ™æ¥å¤„ç†è¯¥ç±»å‹çš„èµ„æºã€‚

æ¯”å¦‚ï¼Œä½ å¯ä»¥æ·»åŠ ä»¥ä¸‹ asset modules é…ç½®ï¼Œæ¥ä¿æŒä¸ CRA ç›¸åŒçš„è¾“å‡ºç»“æœï¼š

```ts title="rsbuild.config.ts"
export default {
  tools: {
    rspack: {
      module: {
        rules: [
          {
            // åŒ¹é… .png æ–‡ä»¶
            // ä½ å¯ä»¥è°ƒæ•´è¯¥æ­£åˆ™è¡¨è¾¾å¼ï¼Œä»¥åŒ¹é…ä¸åŒç±»å‹çš„æ–‡ä»¶
            test: /\.png$/,
            type: 'asset/resource',
            generator: {
              filename: 'static/media/[name].[hash][ext]',
            },
          },
        ],
      },
    },
  },
};
```

## ç§»é™¤ react-app-polyfill

CRA æä¾›äº† [react-app-polyfill](https://www.npmjs.com/package/react-app-polyfill) æ¥æ‰‹åŠ¨æ³¨å…¥ polyfill ä»£ç ã€‚

åœ¨ Rsbuild é¡¹ç›®ä¸­ï¼Œä½ å¯ä»¥ç§»é™¤ react-app-polyfill ç›¸å…³çš„ä¾èµ–å’Œä»£ç ï¼Œå› ä¸º Rsbuild ä¼šè‡ªåŠ¨è¯»å– browserslist é…ç½®ï¼Œå¹¶å…è®¸ä½ é€šè¿‡ [output.polyfill](/config/output/polyfill) é…ç½®é¡¹æ¥å¯ç”¨ polyfill æ³¨å…¥ã€‚

1. ç§»é™¤ `react-app-polyfill` å¼•ç”¨ï¼š

```diff title="src/index.js"
- import 'react-app-polyfill/ie11';
- import 'react-app-polyfill/stable';
```

2. é…ç½® [output.polyfill](/config/output/polyfill)ï¼š

```ts title="rsbuild.config.ts"
export default {
  output: {
    polyfill: 'usage',
  },
};
```

> å‚è€ƒ [æµè§ˆå™¨å…¼å®¹æ€§](/guide/advanced/browser-compatibility) æ¥äº†è§£ Rsbuild æ˜¯å¦‚ä½•å¤„ç† polyfill çš„ã€‚

## æ·»åŠ  ESLint æ’ä»¶

CRA é»˜è®¤å¯ç”¨äº† [eslint-webpack-plugin](https://github.com/webpack-contrib/eslint-webpack-plugin)ï¼Œå¹¶å†…ç½®äº†ä¸€å¥— ESLint è§„åˆ™é›†ã€‚

åœ¨ Rsbuild é¡¹ç›®ä¸­ï¼Œå¦‚æœä½ éœ€è¦ä¿æŒç±»ä¼¼çš„è¡Œä¸ºï¼Œå¯ä»¥æ·»åŠ  [@rsbuild/plugin-eslint](https://github.com/rspack-contrib/rsbuild-plugin-eslint)ï¼Œå¹¶ä½¿ç”¨ [eslint-config-react-app](https://www.npmjs.com/package/eslint-config-react-app) ä½œä¸º ESLint è§„åˆ™é›†ã€‚

```js title=".eslintrc.cjs"
module.exports = {
  extends: 'react-app',
};
```

:::tip
æˆ‘ä»¬å¹¶ä¸æ¨èä½¿ç”¨ `@rsbuild/plugin-eslint`ï¼Œå› ä¸ºåœ¨æ„å»ºè¿‡ç¨‹ä¸­å…è®¸ ESLint æ£€æŸ¥ä¼šæ˜¾è‘—å¢åŠ æ„å»ºæ—¶é—´ã€‚æ›´æ¨èçš„åšæ³•æ˜¯ä½¿ç”¨å•ç‹¬çš„ `lint` å‘½ä»¤æ¥æ‰§è¡Œ ESLint æ£€æŸ¥ã€‚
:::

## è¯»å– jsconfig.json

åœ¨é TypeScript é¡¹ç›®ä¸­ï¼ŒCRA æ”¯æŒè¯»å– jsconfig.json ä¸­çš„ `paths` å­—æ®µä½œä¸ºè·¯å¾„åˆ«åã€‚

å¦‚æœä½ éœ€è¦åœ¨ Rsbuild ä¸­ä½¿ç”¨è¯¥ç‰¹æ€§ï¼Œå¯ä»¥å‚è€ƒ [è·¯å¾„åˆ«å - jsconfig.json](/guide/advanced/alias#jsconfigjson)ã€‚

## CRACO è¿ç§»

å¦‚æœä½ çš„é¡¹ç›®ä½¿ç”¨äº† [CRACO](https://craco.js.org) æ¥è¦†ç›– CRA çš„é…ç½®ï¼Œå¯ä»¥å‚è€ƒä¸‹è¡¨æ¥è¿ç§»ï¼š

| CRACO                                                                                           | Rsbuild                                                                                   |
| ----------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------- |
| [webpack.configure](https://craco.js.org/docs/configuration/webpack/#webpackconfigure)          | [tools.rspack](/config/tools/rspack)                                                      |
| [webpack.alias](https://craco.js.org/docs/configuration/webpack/#webpackalias)                  | [resolve.alias](/config/resolve/alias)                                                    |
| [webpack.plugins.add](https://craco.js.org/docs/configuration/webpack/#webpackplugins)          | [appendPlugins of tools.rspack](/config/tools/rspack#appendplugins)                       |
| [webpack.plugins.remove](https://craco.js.org/docs/configuration/webpack/#webpackpluginsremove) | [removePlugin of tools.rspack](/config/tools/rspack#removeplugin)                         |
| [style.modules](https://craco.js.org/docs/configuration/style/#stylemodules)                    | [output.cssModules](/config/output/css-modules)                                           |
| [style.css](https://craco.js.org/docs/configuration/style/#stylecss)                            | [tools.cssLoader](/config/tools/css-loader)                                               |
| [style.sass](https://craco.js.org/docs/configuration/style/#stylesass)                          | [Sass æ’ä»¶](/plugins/list/plugin-sass)                                                    |
| [style.postcss](https://craco.js.org/docs/configuration/style/#stylepostcss)                    | [tools.postcss](/config/tools/postcss)                                                    |
| [babel](https://craco.js.org/docs/configuration/babel/)                                         | [Babel æ’ä»¶](/plugins/list/plugin-babel)                                                  |
| [typescript](https://craco.js.org/docs/configuration/typescript/)                               | [@rsbuild/plugin-type-check](https://github.com/rspack-contrib/rsbuild-plugin-type-check) |
| [devServer](https://craco.js.org/docs/configuration/devserver/)                                 | [server configs](/config/index)                                                           |

### ç¤ºä¾‹

ä¸‹é¢æ˜¯ä¸€ä¸ªä» `webpack.configure` è¿ç§»åˆ° `tools.rspack` çš„ä¾‹å­ï¼š

- è¿ç§»å‰ï¼š

```js title="craco.config.js"
const { whenDev } = require('@craco/craco');

module.exports = {
  webpack: {
    configure: {
      resolve: {
        mainFields: ['browser', 'module', 'main'],
      },
    },
    plugins: [...whenDev(() => [new MyWebpackPlugin()], [])],
  },
};
```

- è¿ç§»åï¼š

```ts title="rsbuild.config.ts"
export default {
  tools: {
    rspack: {
      resolve: {
        mainFields: ['browser', 'module', 'main'],
      },
      plugins:
        process.env.NODE_ENV === 'development' ? [new MyWebpackPlugin()] : [],
    },
  },
};
```

## å†…å®¹è¡¥å……

å½“å‰æ–‡æ¡£åªæ¶µç›–äº†è¿ç§»è¿‡ç¨‹çš„éƒ¨åˆ†äº‹é¡¹ï¼Œå¦‚æœä½ å‘ç°æœ‰åˆé€‚çš„å†…å®¹å¯ä»¥è¡¥å……ï¼Œæ¬¢è¿é€šè¿‡ pull request æ¥å®Œå–„æ–‡æ¡£ ğŸ¤ã€‚

> Rsbuild çš„æ–‡æ¡£ä½äº [rsbuild/website](https://github.com/web-infra-dev/rsbuild/tree/main/website) ç›®å½•ã€‚
