# Vite

æœ¬ç« èŠ‚ä»‹ç»å¦‚ä½•å°† Vite é¡¹ç›®è¿ç§»åˆ° Rsbuildã€‚

## å®‰è£…ä¾èµ–

é¦–å…ˆä½ éœ€è¦æŠŠ Vite ç›¸å…³çš„ npm ä¾èµ–æ›¿æ¢ä¸º Rsbuild çš„ä¾èµ–ã€‚

import { PackageManagerTabs } from '@theme';

- ç§»é™¤ Vite çš„ä¾èµ–ï¼š

<PackageManagerTabs command="remove vite" />

- å®‰è£… Rsbuild çš„ä¾èµ–ï¼š

<PackageManagerTabs command="add @rsbuild/core -D" />

## æ›´æ–° npm scripts

ä¸‹ä¸€æ­¥ï¼Œä½ éœ€è¦æŠŠ package.json ä¸­çš„ npm scripts æ›´æ–°ä¸º Rsbuild çš„ CLI å‘½ä»¤ã€‚

```diff title="package.json"
{
  "scripts": {
-   "dev": "vite",
-   "build": "vite build",
-   "preview": "vite preview"
+   "dev": "rsbuild dev",
+   "build": "rsbuild build",
+   "preview": "rsbuild preview"
  }
}
```

## åˆ›å»ºé…ç½®æ–‡ä»¶

åœ¨ package.json çš„åŒçº§ç›®å½•ä¸‹åˆ›å»º Rsbuild çš„é…ç½®æ–‡ä»¶ `rsbuild.config.ts`ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```ts title="rsbuild.config.ts"
import { defineConfig } from '@rsbuild/core';

export default defineConfig({
  plugins: [],
});
```

## æ„å»ºå…¥å£

Rsbuild ä¸ Vite é»˜è®¤çš„æ„å»ºå…¥å£ä¸åŒï¼ŒVite ä½¿ç”¨ `index.html` ä½œä¸ºé»˜è®¤å…¥å£ï¼Œè€Œ Rsbuild ä½¿ç”¨ `src/index.js`ã€‚

ä» Vite è¿ç§»åˆ° Rsbuild æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ Rsbuild æä¾›çš„ [source.entry](/config/source/entry) æ¥è®¾ç½®æ„å»ºå…¥å£ï¼Œ[html.template](/config/html/template) æ¥è®¾ç½®æ¨¡æ¿ã€‚

ä»¥ä¸€ä¸ªæ–°å»ºçš„ Vite é¡¹ç›®ä¸ºä¾‹ï¼Œé¦–å…ˆåˆ é™¤ `index.html` ä¸­çš„ `<script>` æ ‡ç­¾ï¼š

```diff title="index.html"
- <script type="module" src="/src/main.ts"></script>
```

ç„¶åæ·»åŠ å¦‚ä¸‹é…ç½®å³å¯ã€‚

```ts title="rsbuild.config.ts"
export default {
  html: {
    template: './index.html',
  },
  source: {
    entry: {
      index: './src/main.ts',
    },
  },
};
```

Rsbuild ä¼šåœ¨æ„å»ºæ—¶è‡ªåŠ¨æ³¨å…¥ `<script>` æ ‡ç­¾åˆ°ç”Ÿæˆçš„ HTML æ–‡ä»¶ä¸­ã€‚

## è¿ç§»æ’ä»¶

å¤§éƒ¨åˆ†å¸¸è§çš„ Vite æ’ä»¶å¯ä»¥è½»æ¾åœ°è¿ç§»åˆ° Rsbuild æ’ä»¶ï¼Œæ¯”å¦‚ï¼š

| Vite                                                                                       | Rsbuild                                                                                         |
| ------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------- |
| [@vitejs/plugin-react](https://www.npmjs.com/package/@vitejs/plugin-react)                 | [@rsbuild/plugin-react](/plugins/list/plugin-react)                                             |
| [@vitejs/plugin-react-swc](https://www.npmjs.com/package/@vitejs/plugin-react-swc)         | [@rsbuild/plugin-react](/plugins/list/plugin-react)                                             |
| [@vitejs/plugin-vue](https://www.npmjs.com/package/@vitejs/plugin-vue)                     | [@rsbuild/plugin-vue](/plugins/list/plugin-vue)                                                 |
| [@vitejs/plugin-vue2](https://www.npmjs.com/package/@vitejs/plugin-vue2)                   | [@rsbuild/plugin-vue2](https://github.com/rspack-contrib/rsbuild-plugin-vue2)                   |
| [@vitejs/plugin-vue-jsx](https://www.npmjs.com/package/@vitejs/plugin-vue-jsx)             | [@rsbuild/plugin-vue-jsx](https://github.com/rspack-contrib/rsbuild-plugin-vue-jsx)             |
| [@vitejs/plugin-vue2-jsx](https://www.npmjs.com/package/@vitejs/plugin-vue2-jsx)           | [@rsbuild/plugin-vue2-jsx](https://github.com/rspack-contrib/rsbuild-plugin-vue2-jsx)           |
| [@vitejs/plugin-basic-ssl](https://www.npmjs.com/package/@vitejs/plugin-basic-ssl)         | [@rsbuild/plugin-basic-ssl](https://github.com/rspack-contrib/rsbuild-plugin-basic-ssl)         |
| [@vitejs/plugin-legacy](https://www.npmjs.com/package/@vitejs/plugin-legacy)               | æ— é¡»ä½¿ç”¨ï¼Œè¯¦è§ [æµè§ˆå™¨å…¼å®¹æ€§](/guide/advanced/browser-compatibility)                            |
| [@sveltejs/vite-plugin-svelte](https://www.npmjs.com/package/@sveltejs/vite-plugin-svelte) | [@rsbuild/plugin-svelte](/plugins/list/plugin-svelte)                                           |
| [vite-plugin-svgr](https://www.npmjs.com/package/vite-plugin-svgr)                         | [@rsbuild/plugin-svgr](/plugins/list/plugin-svgr)                                               |
| [vite-plugin-checker](https://www.npmjs.com/package/vite-plugin-checker)                   | [@rsbuild/plugin-type-check](https://github.com/rspack-contrib/rsbuild-plugin-type-check)       |
| [vite-plugin-eslint](https://www.npmjs.com/package/vite-plugin-eslint)                     | [@rsbuild/plugin-eslint](https://github.com/rspack-contrib/rsbuild-plugin-eslint)               |
| [vite-plugin-static-copy](https://www.npmjs.com/package/vite-plugin-static-copy)           | [output.copy](/config/output/copy)                                                              |
| [vite-plugin-node-polyfills](https://www.npmjs.com/package/vite-plugin-node-polyfills)     | [@rsbuild/plugin-node-polyfill](https://github.com/rspack-contrib/rsbuild-plugin-node-polyfill) |
| [vite-plugin-solid](https://www.npmjs.com/package/vite-plugin-solid)                       | [@rsbuild/plugin-solid](/plugins/list/plugin-solid)                                             |
| [@preact/preset-vite](https://www.npmjs.com/package/@preact/preset-vite)                   | [@rsbuild/plugin-preact](/plugins/list/plugin-preact)                                           |

ä½ å¯ä»¥å‚è€ƒ [æ’ä»¶åˆ—è¡¨](/plugins/list/index) æ¥äº†è§£æ›´å¤šå¯ç”¨çš„æ’ä»¶ã€‚

## é…ç½®è¿ç§»

ä»¥ä¸‹æ˜¯ Vite é…ç½®å¯¹åº”çš„ Rsbuild é…ç½®ï¼š

| Vite                                  | Rsbuild                                                          |
| ------------------------------------- | ---------------------------------------------------------------- |
| root                                  | [root](/config/root)                                             |
| mode                                  | [mode](/config/mode)                                             |
| base                                  | [server.base](/config/server/base)                               |
| define                                | [source.define](/config/source/define)                           |
| appType                               | [server.historyApiFallback](/config/server/history-api-fallback) |
| plugins                               | [plugins](/config/plugins)                                       |
| envDir                                | [Env Directory](/guide/advanced/env-vars#env-ç›®å½•)               |
| publicDir                             | [server.publicDir](/config/server/public-dir)                    |
| assetsInclude                         | [source.assetsInclude](/config/source/assets-include)            |
| resolve.alias                         | [resolve.alias](/config/resolve/alias)                           |
| resolve.dedupe                        | [resolve.dedupe](/config/resolve/dedupe)                         |
| resolve.extensions                    | [resolve.extensions](/config/resolve/extensions)                 |
| resolve.conditions                    | [tools.rspack.resolve.conditionNames](/config/tools/rspack)      |
| resolve.mainFields                    | [tools.rspack.resolve.mainFields](/config/tools/rspack)          |
| resolve.preserveSymlinks              | [tools.rspack.resolve.symlinks](/config/tools/rspack)            |
| html.cspNonce                         | [security.nonce](/config/security/nonce)                         |
| css.modules                           | [output.cssModules](/config/output/css-modules)                  |
| css.postcss                           | [tools.postcss](/config/tools/postcss)                           |
| css.preprocessorOptions.sass          | [pluginSass](/plugins/list/plugin-sass)                          |
| css.preprocessorOptions.less          | [pluginLess](/plugins/list/plugin-less)                          |
| css.preprocessorOptions.stylus        | [pluginStylus](/plugins/list/plugin-stylus)                      |
| css.devSourcemap                      | [output.sourceMap](/config/output/source-map)                    |
| css.lightningcss                      | [tools.lightningcssLoader](/config/tools/lightningcss-loader)    |
| server.host, preview.host             | [server.host](/config/server/host)                               |
| server.port, preview.port             | [server.port](/config/server/port)                               |
| server.cors, preview.cors             | [server.cors](/config/server/cors)                               |
| server.strictPort, preview.strictPort | [server.strictPort](/config/server/strict-port)                  |
| server.https, preview.https           | [server.https](/config/server/https)                             |
| server.open, preview.open             | [server.open](/config/server/open)                               |
| server.proxy, preview.proxy           | [server.proxy](/config/server/proxy)                             |
| server.headers, preview.headers       | [server.headers](/config/server/headers)                         |
| server.hmr                            | [dev.hmr](/config/dev/hmr), [dev.client](/config/dev/client)     |
| server.middlewareMode                 | [server.middlewareMode](/config/server/middleware-mode)          |
| build.target, build.cssTarget         | [Browserslist](/guide/advanced/browserslist)                     |
| build.outDir, build.assetsDir         | [output.distPath](/config/output/dist-path)                      |
| build.assetsInlineLimit               | [output.dataUriLimit](/config/output/data-uri-limit)             |
| build.cssMinify                       | [output.minify](/config/output/minify)                           |
| build.sourcemap                       | [output.sourceMap](/config/output/source-map)                    |
| build.lib                             | Use [Rslib](https://github.com/web-infra-dev/rslib)              |
| build.manifest                        | [output.manifest](/config/output/manifest)                       |
| build.ssrEmitAssets                   | [output.emitAssets](/config/output/emit-assets)                  |
| build.minify, build.terserOptions     | [output.minify](/config/output/minify)                           |
| build.emptyOutDir                     | [output.cleanDistPath](/config/output/clean-dist-path)           |
| build.copyPublicDir                   | [server.publicDir](/config/server/public-dir)                    |
| build.reportCompressedSize            | [performance.printFileSize](/config/performance/print-file-size) |
| ssr, worker                           | [environments](/config/environments)                             |

è¯´æ˜ï¼š

- ä¸Šè¿°è¡¨æ ¼å°šæœªè¦†ç›–åˆ° Vite çš„æ‰€æœ‰é…ç½®ï¼Œæ¬¢è¿è¡¥å……ã€‚

## ç¯å¢ƒå˜é‡

Vite é»˜è®¤ä¼šå°† `VITE_` å¼€å¤´çš„ç¯å¢ƒå˜é‡æ³¨å…¥åˆ° client ä»£ç ä¸­ï¼Œè€Œ Rsbuild é»˜è®¤ä¼šæ³¨å…¥ `PUBLIC_` å¼€å¤´çš„ç¯å¢ƒå˜é‡ï¼ˆå‚è€ƒ [public å˜é‡](/guide/advanced/env-vars#public-å˜é‡)ï¼‰ã€‚

ä¸ºäº†å…¼å®¹ Vite çš„è¡Œä¸ºï¼Œä½ å¯ä»¥æ‰‹åŠ¨è°ƒç”¨ Rsbuild æä¾›çš„ [loadEnv](/api/javascript-api/core#loadenv) æ–¹æ³•æ¥è¯»å– `VITE_` å¼€å¤´çš„ç¯å¢ƒå˜é‡ï¼Œå¹¶é€šè¿‡ [source.define](/config/source/define) é…ç½®é¡¹æ³¨å…¥åˆ° client ä»£ç ä¸­ã€‚

```ts title="rsbuild.config.ts"
import { defineConfig, loadEnv } from '@rsbuild/core';

const { publicVars } = loadEnv({ prefixes: ['VITE_'] });

export default defineConfig({
  source: {
    define: publicVars,
  },
});
```

Rsbuild é»˜è®¤æ³¨å…¥äº†ä»¥ä¸‹ [ç¯å¢ƒå˜é‡](/guide/advanced/env-vars)ï¼š

- `import.meta.env.MODE`
- `import.meta.env.BASE_URL`
- `import.meta.env.PROD`
- `import.meta.env.DEV`

å¯¹äº `import.meta.env.SSR`ï¼Œä½ å¯ä»¥é€šè¿‡ [environments](/config/environments) å’Œ [source.define](/config/source/define) é…ç½®é¡¹æ¥è®¾ç½®ï¼š

```ts title="rsbuild.config.ts"
export default defineConfig({
  environments: {
    web: {
      source: {
        define: {
          'import.meta.env.SSR': JSON.stringify(false),
        },
      },
    },
    node: {
      source: {
        define: {
          'import.meta.env.SSR': JSON.stringify(true),
        },
      },
      output: {
        target: 'node',
      },
    },
  },
});
```

## é¢„è®¾ç±»å‹

Vite é€šè¿‡ `vite-env.d.ts` æ–‡ä»¶æä¾›äº†ä¸€äº›é¢„è®¾çš„ç±»å‹å®šä¹‰ï¼Œè¿ç§»åˆ° Rsbuild æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ `@rsbuild/core` æä¾›çš„ [é¢„è®¾ç±»å‹](/guide/basic/typescript#é¢„è®¾ç±»å‹)ï¼š

```diff title="src/env.d.ts"
- /// <reference types="vite/client" />
+ /// <reference types="@rsbuild/core/types" />
```

## Glob import

Vite æä¾›äº† `import.meta.glob()` æ¥æ‰¹é‡å¯¼å…¥æ¨¡å—ã€‚

è¿ç§»åˆ° Rsbuild æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ Rspack çš„ [import.meta.webpackContext](https://rspack.dev/zh/api/runtime-api/module-variables#importmetawebpackcontext) å‡½æ•°ä»£æ›¿ï¼š

- Vite:

```js
const modules = import.meta.glob('./dir/*.js');

for (const path in modules) {
  modules[path]().then((mod) => {
    console.log(path, mod);
  });
}
```

- Rsbuild:

```js
const context = import.meta.webpackContext('./dir', {
  // æ˜¯å¦æœç´¢å­ç›®å½•
  recursive: false,
  regExp: /\.js$/,
});

for (const path of context.keys()) {
  const mod = context(path);
  console.log(path, mod);
}
```

## è¿ç§» Vite æ’ä»¶

Rsbuild çš„æ’ä»¶ API è¦†ç›–äº†å¤§éƒ¨åˆ†çš„ Vite å’Œ Rollup æ’ä»¶ hooksï¼Œä¾‹å¦‚ï¼š

| Vite æ’ä»¶ hooks   | Rsbuild æ’ä»¶ API                                                                                                       |
| ----------------- | ---------------------------------------------------------------------------------------------------------------------- |
| `resolveId`       | [resolve](/plugins/dev/core#apiresolve)                                                                                |
| `transform`       | [transform](/plugins/dev/core#apitransform)                                                                            |
| `config`          | [modifyRsbuildConfig](/plugins/dev/hooks#modifyrsbuildconfig)                                                          |
| `configResolved`  | [getNormalizedConfig](/plugins/dev/core#apigetnormalizedconfig)                                                        |
| `configureServer` | [onBeforeStartDevServer](/plugins/dev/hooks#onbeforestartdevserver)                                                    |
| `buildStart`      | [onBeforeBuild](/plugins/dev/hooks#onbeforebuild), [onBeforeStartDevServer](/plugins/dev/hooks#onbeforestartdevserver) |
| `buildEnd`        | [onAfterBuild](/plugins/dev/hooks#onafterbuild), [onCloseDevServer](/plugins/dev/hooks#onclosedevserver)               |
| `closeBundle`     | [onCloseBuild](/plugins/dev/hooks#onclosebuild), [onCloseDevServer](/plugins/dev/hooks#onclosedevserver)               |

è¯·å‚è€ƒ [æ’ä»¶ç³»ç»Ÿ](/plugins/dev/index) æ–‡æ¡£æ¥äº†è§£æ›´å¤šã€‚

## éªŒè¯ç»“æœ

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œä½ å·²ç»å®Œæˆäº†ä» Vite åˆ° Rsbuild çš„åŸºæœ¬è¿ç§»ï¼Œæ­¤æ—¶å¯ä»¥æ‰§è¡Œ `npm run dev` å‘½ä»¤æ¥å°è¯•å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚

å¦‚æœåœ¨æ„å»ºè¿‡ç¨‹ä¸­å‘ç°é—®é¢˜ï¼Œè¯·æ ¹æ®é”™è¯¯æ—¥å¿—è¿›è¡Œè°ƒè¯•ï¼Œæˆ–è€…æŸ¥çœ‹ Vite é…ç½®ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ä¸€äº›å¿…é¡»çš„é…ç½®æœªè¢«è¿ç§»åˆ° Rsbuildã€‚

## å†…å®¹è¡¥å……

å½“å‰æ–‡æ¡£åªæ¶µç›–äº†è¿ç§»è¿‡ç¨‹çš„éƒ¨åˆ†äº‹é¡¹ï¼Œå¦‚æœä½ å‘ç°æœ‰åˆé€‚çš„å†…å®¹å¯ä»¥è¡¥å……ï¼Œæ¬¢è¿é€šè¿‡ pull request æ¥å®Œå–„æ–‡æ¡£ ğŸ¤ã€‚

> Rsbuild çš„æ–‡æ¡£ä½äº [rsbuild/website](https://github.com/web-infra-dev/rsbuild/tree/main/website) ç›®å½•ã€‚
