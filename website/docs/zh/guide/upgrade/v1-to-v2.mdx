# 从 v1 升级到 v2

当前文档列出了从 Rsbuild 1.x 到 2.0 的所有不兼容更新，你可以参考此文档来迁移。

> 本指南仍在持续完善中。随着 Rsbuild 2.0 Beta 的推进，相关内容将逐步补充。

## 配置

### 移除 `source.alias`

废弃的 `source.alias` 选项已被移除，使用 [resolve.alias](/config/resolve/alias) 进行替代。

```diff
export default {
- source: {
+ resolve: {
    alias: {
      '@': './src',
    },
  },
};
```

### 移除 `source.aliasStrategy`

废弃的 `source.aliasStrategy` 选项已被移除，使用 [resolve.aliasStrategy](/config/resolve/alias-strategy) 进行替代。

```diff
export default {
- source: {
+ resolve: {
    aliasStrategy: 'prefer-alias',
  },
};
```

### 移除 `performance.bundleAnalyze`

废弃的 `performance.bundleAnalyze` 选项已被移除。

早期 Rsbuild 内置了 `webpack-bundle-analyzer`，但如今 Rsdoctor 已支持产物体积分析，因此无需在 `@rsbuild/core` 中继续内置；同时移除内置依赖可以降低安装体积。

推荐使用 [Rsdoctor](/guide/debug/rsdoctor) 分析产物体积，或通过 [tools.rspack](/config/tools/rspack) 自行注册 [webpack-bundle-analyzer](https://www.npmjs.com/package/webpack-bundle-analyzer)：

```ts
import { BundleAnalyzerPlugin } from 'webpack-bundle-analyzer';

export default {
  tools: {
    rspack: {
      plugins: [
        new BundleAnalyzerPlugin({
          analyzerMode: 'static',
        }),
      ],
    },
  },
};
```

### 移除 `performance.profile`

`performance.profile` 选项已被移除。如果你依赖它来输出 stats JSON 文件，可以在自定义插件中调用 [stats.toJson()](/api/javascript-api/instance#stats-object) 代替：

```ts
import { writeFileSync } from 'node:fs';
import { join } from 'node:path';

const statsJsonPlugin = {
  name: 'stats-json-plugin',
  setup(api) {
    api.onAfterBuild(({ stats }) => {
      writeFileSync(
        join(api.context.distPath, 'stats.json'),
        JSON.stringify(stats?.toJson({}), null, 2),
      );
    });
  },
};
```

### 移除 HTML 模板参数

`html.templateParameters` 中废弃的默认参数已被移除：

- `webpackConfig`：使用 `rspackConfig` 代替。
- `htmlWebpackPlugin`：使用 `htmlPlugin` 代替。

## JavaScript API

- 移除 `rsbuild.build()` 中废弃的 `compiler` 参数

## 移除 webpack 支持

Rsbuild 2.0 不再支持使用 webpack 作为打包工具。在 Rsbuild 1.x 版本中，该能力主要用于验证 Rspack 与 webpack 之间的兼容性。随着 Rspack 的逐步成熟和稳定，这一用途已不再必要，因此相关支持被正式移除。

具体变更如下：

- 移除 `@rsbuild/webpack` 包。
- 移除 `@rsbuild/plugin-webpack-swc` 包。
- 移除 `provider` 配置项。
- 移除 `tools.webpack` 和 `tools.webpackChain` 配置项。
- 移除 `api.modifyWebpackChain` 和 `api.modifyWebpackConfig` 插件钩子。
- 移除 `api.context.bundlerType` 中的 `webpack` 类型。
- 移除 webpack 相关的类型。
