# 从 v1 升级到 v2

当前文档列出了从 Rsbuild 1.x 到 2.0 的所有不兼容更新，你可以参考此文档来迁移。

> 本指南仍在持续完善中。随着 Rsbuild 2.0 Beta 的推进，相关内容将逐步补充。

## Node.js 支持

由于 Node.js 18 已经在 2025 年 4 月 [结束维护](https://nodejs.org/en/about/eol)，Rsbuild 2.0 将不再支持该版本。

Rsbuild 2.0 最低支持版本为 Node.js 20.19+ 或 22.12+。

## Pure ESM 包

[@rsbuild/core](https://www.npmjs.com/package/@rsbuild/core) 现已以 pure ESM 包的形式发布，并移除了自身的 CommonJS 构建产物。这一调整仅影响 Rsbuild 本身的发布形式，使安装体积减少了约 500KB。

在 Node.js 20 及以上版本中，运行时已原生支持通过 [require(esm)](https://nodejs.org/api/modules.html#loading-ecmascript-modules-using-require) 加载 ESM 模块。因此，对大多数仍通过 JavaScript API 使用 Rsbuild 的项目来说，这一变更通常不会带来实际影响，也无需额外修改现有代码。

> 这一变更不影响 Rsbuild 构建 CommonJS 产物的能力，相关的构建行为和配置方式也保持不变。

## 配置

### 移除 `source.alias`

废弃的 `source.alias` 选项已被移除，使用 [resolve.alias](/config/resolve/alias) 进行替代。

```diff title="rsbuild.config.ts"
export default {
- source: {
+ resolve: {
    alias: {
      '@': './src',
    },
  },
};
```

### 移除 `source.aliasStrategy`

废弃的 `source.aliasStrategy` 选项已被移除，使用 [resolve.aliasStrategy](/config/resolve/alias-strategy) 进行替代。

```diff title="rsbuild.config.ts"
export default {
- source: {
+ resolve: {
    aliasStrategy: 'prefer-alias',
  },
};
```

### 移除 `performance.bundleAnalyze`

废弃的 `performance.bundleAnalyze` 选项已被移除。

早期 Rsbuild 内置了 `webpack-bundle-analyzer`，但如今 Rsdoctor 已支持产物体积分析，因此无需在 `@rsbuild/core` 中继续内置；同时移除内置依赖可以降低安装体积。

推荐使用 [Rsdoctor](/guide/debug/rsdoctor) 分析产物体积，或通过 [tools.rspack](/config/tools/rspack) 自行注册 [webpack-bundle-analyzer](https://www.npmjs.com/package/webpack-bundle-analyzer)：

```ts title="rsbuild.config.ts"
import { BundleAnalyzerPlugin } from 'webpack-bundle-analyzer';

export default {
  tools: {
    rspack: {
      plugins: [
        new BundleAnalyzerPlugin({
          analyzerMode: 'static',
        }),
      ],
    },
  },
};
```

### 移除 `performance.profile`

`performance.profile` 选项已被移除。如果你依赖它来输出 stats JSON 文件，可以在自定义插件中调用 [stats.toJson()](/api/javascript-api/instance#stats-object) 代替：

```ts title="rsbuild.config.ts"
import { writeFileSync } from 'node:fs';
import { join } from 'node:path';

const statsJsonPlugin = {
  name: 'stats-json-plugin',
  setup(api) {
    api.onAfterBuild(({ stats }) => {
      writeFileSync(
        join(api.context.distPath, 'stats.json'),
        JSON.stringify(stats?.toJson({}), null, 2),
      );
    });
  },
};

export default {
  plugins: [statsJsonPlugin],
};
```

### 移除 HTML 模板参数

`html.templateParameters` 中废弃的默认参数已被移除：

- `webpackConfig`：使用 `rspackConfig` 代替。
- `htmlWebpackPlugin`：使用 `htmlPlugin` 代替。

### Node 压缩

在 Node 目标下，生产环境构建默认不再开启压缩。

服务端产物会优先保证可调试性、清晰的堆栈信息与稳定的运行时行为，而非体积。如果你仍需要压缩产物，可以显式开启 [output.minify](/config/output/minify):

```ts title="rsbuild.config.ts"
export default {
  output: {
    target: 'node',
    minify: true,
  },
};
```

## JavaScript API

- 移除 `rsbuild.build()` 中废弃的 `compiler` 参数
- 移除 `rsbuild.startDevServer()` 中废弃的 `compiler` 参数

## 移除 webpack 支持

Rsbuild 2.0 不再支持使用 webpack 作为打包工具。在 Rsbuild 1.x 版本中，该能力主要用于验证 Rspack 与 webpack 之间的兼容性。随着 Rspack 的逐步成熟和稳定，这一用途已不再必要，因此相关支持被正式移除。

具体变更如下：

- 移除 `@rsbuild/webpack` 包。
- 移除 `@rsbuild/plugin-webpack-swc` 包。
- 移除 `provider` 配置项。
- 移除 `tools.webpack` 和 `tools.webpackChain` 配置项。
- 移除 `api.modifyWebpackChain` 和 `api.modifyWebpackConfig` 插件钩子。
- 移除 `api.context.bundlerType` 中的 `webpack` 类型。
- 移除 webpack 相关的类型。
