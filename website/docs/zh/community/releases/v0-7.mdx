---
published_at: 2024-05-23 18:00:00
---

# Rsbuild v0.7 发布

> May 23, 2024

![](https://assets.rspack.dev/rsbuild/rsbuild-banner-with-storybook.png)

Rsbuild v0.7 已与 Rspack v0.7 同步发布，值得关注的变更有：

- [支持 Storybook](#支持-storybook)
- [更快的 Sass 编译](#更快的-sass-编译)
- [更好的 CSS 支持](#更好的-css-支持)
- [CSS Modules 类型生成](#css-modules-类型生成)
- 更多...

## 支持 Storybook

TODO

## 更快的 Sass 编译

在 Rsbuild 0.7 中，**Sass 编译速度提高了 3~10 倍**，在大型项目项目中的性能提升尤为显著。

以编译 Bootstrap 的 Sass 代码为例，Rsbuild v0.6 和 v0.7 的构建时间对比：

![](https://assets.rspack.dev/rsbuild/assets/sass-embedded-compare.jpeg)

这得益于 Rsbuild 默认启用了 [sass-embedded](https://www.npmjs.com/package/sass-embedded)，它是一个围绕原生 Dart Sass 可执行文件的 JavaScript wrapper，具备一致的 API 和更优秀的性能。

此外，Rsbuild 还启用了 `sass-loader` 最新的 [modern-compiler](https://github.com/webpack-contrib/sass-loader/releases/tag/v14.2.0) API，这能够开启 Sass 的 shared resources 能力，在编译多个文件时重复利用相同的 compiler 进程，从而提升构建速度。

## 更好的 CSS 支持

Rsbuild 现在使用 [CssExtractRspackPlugin](https://www.rspack.dev/plugins/rspack/css-extract-rspack-plugin) 来提取 CSS 到单独的文件中，而不是使用 `experimental.css` 配置来实现。

这允许 Rsbuild 支持更多 CSS 特性，包括：

- 支持在 Vue SFC 中使用 `<style module>`：

```html title="index.vue"
<template>
  <p :class="$style.red">Red</p>
</template>

<style module>
  .red {
    color: red;
  }
</style>
```

- 支持复杂的 CSS Modules `:global()` 语法

```css title="style.module.css"
:local(.parent):global(.child) > ul {
  color: red;
}
```

- 支持更多的 CSS Modules 选项，如 [cssModules.exportGlobals](/config/output/css-modules#cssmodulesexportglobals)
- 现在你可以使用 [tools.cssExtract](/config/tools/css-extract) 来配置 CssExtractRspackPlugin。

## CSS Modules 类型生成

Rsbuild v0.7 新增了 [Typed CSS Modules 插件](/plugins/list/plugin-typed-css-modules)，用于为项目中的 CSS Modules 文件生成类型声明文件。

当你在 TypeScript 项目里使用 CSS Modules 时，默认的类型定义如下。它只能提供基本的类型支持，无法准确地提示出 CSS Modules 导出了哪些类名。

```ts title="src/env.d.ts"
declare module '*.module.css' {
  const classes: { readonly [key: string]: string };
  export default classes;
}
```

在使用 Typed CSS Modules 插件后，Rsbuild 会为项目中所有的 CSS Modules 生成类型声明文件，提供准确的类型提示。

例如，创建 `src/index.ts` 和 `src/index.module.css` 两个文件：

```tsx title="src/index.ts"
import styles from './index.module.css';

console.log(styles.pageHeader);
```

```css title="index.module.css"
.page-header {
  color: black;
}
```

构建后，Rsbuild 会自动生成 `src/index.module.css.d.ts` 类型声明文件：

```ts title="src/index.module.css.d.ts"
interface CssExports {
  'page-header': string;
  pageHeader: string;
}
export const cssExports: CssExports;
export default cssExports;
```

此时再打开 `src/index.ts` 文件，可以看到 `styles` 对象已经具备了准确的类型。

## ESM/CJS 导出

现在，Rsbuild 的所有包均提供了 ES modules 和 CommonJS 两种格式的导出，并在 package.json 中声明了 `"type"="module"`。

![](https://assets.rspack.dev/rsbuild/assets/rsbuild-dual-package-example.png)

这使你能够使用 `import` 或 `require` 来使用 Rsbuild 的 JavaScript API：

```js
// ES Modules
import { createRsbuild } from '@rsbuild/core';

// CommonJS
const { createRsbuild } = require('@rsbuild/core');
```

ESM/CJS 互操作是一个棘手的问题，因此我们计划长期提供这两种格式，以便于更多用户使用。

## dataUriLimit 默认值

[output.dataUriLimit](/config/output/data-uri-limit) 的默认值从 `10000 (10kB)` 调整为 `4096 (4KiB)`.

这是因为目前更多的应用正在使用 HTTP 2.0，所以将资源分割成单独的文件会表现得更好。而且将超过 4KiB 的资源内联可能会使 JS 包体积过大，不利于缓存。

如果你倾向于之前的默认设置，可以添加以下配置：

```js title="rsbuild.config.ts"
export default {
  output: {
    dataUriLimit: 10000,
  },
};
```
