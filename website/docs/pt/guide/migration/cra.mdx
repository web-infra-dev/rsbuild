# Create React App

Este capÃ­tulo apresenta como migrar um projeto [Create React App](https://github.com/facebook/create-react-app) (CRA) ou [CRACO](https://craco.js.org/) para o Rsbuild.

:::tip CRA eject
Se o seu projeto jÃ¡ executou o comando `eject` do CRA, entÃ£o a maior parte do conteÃºdo deste documento nÃ£o serÃ¡ mais aplicÃ¡vel.

ApÃ³s ejetar um projeto CRA, ele se torna mais parecido com um projeto que usa diretamente o webpack, entÃ£o vocÃª pode consultar o [guia de migraÃ§Ã£o do webpack](/guide/migration/webpack).
:::

## Instalando dependÃªncias

Primeiro, vocÃª precisa substituir as dependÃªncias npm do CRA pelas dependÃªncias do Rsbuild.

import { PackageManagerTabs } from '@theme';

- Remover dependÃªncias do CRA:

<PackageManagerTabs command="remove react-scripts" />

> Para projetos que usam CRACO, vocÃª tambÃ©m pode remover a dependÃªncia @craco/craco.

- Instalar dependÃªncias do Rsbuild:

<PackageManagerTabs command="add @rsbuild/core @rsbuild/plugin-react -D" />

## Atualizando scripts npm

Em seguida, vocÃª precisa atualizar os scripts npm em package.json para os comandos CLI do Rsbuild.

```json title="package.json"
{
  "scripts": {
    "start": "react-scripts start", // [!code --]
    "build": "react-scripts build", // [!code --]
    "eject": "react-scripts eject", // [!code --]
    "start": "rsbuild dev", // [!code ++]
    "build": "rsbuild build", // [!code ++]
    "preview": "rsbuild preview" // [!code ++]
  }
}
```

:::tip
O Rsbuild nÃ£o integra frameworks de teste, entÃ£o ele nÃ£o fornece um comando para substituir `react-scripts test`. VocÃª pode usar diretamente frameworks de teste como Jest ou Vitest. VocÃª pode consultar o projeto de exemplo [Rsbuild react-jest](https://github.com/rspack-contrib/rstack-examples/tree/main/rsbuild/react-jest) para configuraÃ§Ã£o.
:::

## Criando arquivo de configuraÃ§Ã£o

Crie um arquivo de configuraÃ§Ã£o do Rsbuild `rsbuild.config.ts` no mesmo diretÃ³rio do package.json e adicione o seguinte conteÃºdo:

```typescript title="rsbuild.config.ts"
import { defineConfig } from '@rsbuild/core';
import { pluginReact } from '@rsbuild/plugin-react';

export default defineConfig({
  plugins: [pluginReact()],
});
```

## Template HTML

O CRA usa o arquivo `public/index.html` como o template HTML padrÃ£o. No Rsbuild, vocÃª pode especificar o template HTML atravÃ©s de [html.template](/config/html/template):

```ts title="rsbuild.config.ts"
export default defineConfig({
  html: {
    template: './public/index.html',
  },
});
```

No template HTML, se vocÃª estiver usando a variÃ¡vel `%PUBLIC_URL%` do CRA, substitua-a pela [variÃ¡vel assetPrefix](/config/html/template-parameters) do Rsbuild e use uma barra para concatenaÃ§Ã£o:

```html
<!-- [!code --] -->
<link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
<!-- [!code ++] -->
<link rel="icon" href="<%= assetPrefix %>/favicon.ico" />
```

Isso completa a migraÃ§Ã£o bÃ¡sica do CRA para o Rsbuild. Agora vocÃª pode executar o comando `npm run start` para tentar iniciar o servidor de desenvolvimento.

## DiretÃ³rio de saÃ­da

Por padrÃ£o, o CRA gera a saÃ­da para o diretÃ³rio `build`, enquanto o diretÃ³rio de saÃ­da padrÃ£o do Rsbuild Ã© `dist`.

You can configure Rsbuild's [output.distPath.root](/config/output/dist-path) option to change the directory to `build`, in line with CRA:

```ts title="rsbuild.config.ts"
export default {
  output: {
    distPath: {
      root: 'build',
    },
  },
};
```

> Para mais detalhes, consulte a seÃ§Ã£o [Arquivos de SaÃ­da](/guide/basic/output-files).

## Usando prÃ©-processadores CSS

O Rsbuild suporta prÃ©-processadores CSS como Sass e Less atravÃ©s de plugins. Consulte:

- [Sass Plugin](/plugins/list/plugin-sass)
- [Less Plugin](/plugins/list/plugin-less)
- [Stylus Plugin](/plugins/list/plugin-stylus)

## Usando SVGR

Se vocÃª estiver usando o recurso "SVG para Componente React" do CRA (ou seja, [SVGR](https://react-svgr.com/)), vocÃª tambÃ©m precisarÃ¡ instalar o plugin SVGR para o Rsbuild.

Por exemplo, se vocÃª estiver usando o seguinte:

```jsx
import { ReactComponent as Logo } from './logo.svg';

const App = () => (
  <div>
    <Logo />
  </div>
);
```

You only need to install and register `@rsbuild/plugin-svgr`:

```ts title="rsbuild.config.ts"
import { pluginSvgr } from '@rsbuild/plugin-svgr';

export default {
  plugins: [pluginSvgr({ mixedImport: true })],
};
```

Consulte a documentaÃ§Ã£o [plugin SVGR](/plugins/list/plugin-svgr) para saber como usar o SVGR no Rsbuild.

## MigraÃ§Ã£o de configuraÃ§Ã£o

Hera is the corresponding Rsbuild configuration for [CRA configuration](https://create-react-app.dev/docs/advanced-configuration/):

| CRA                     | Rsbuild                                                                                         |
| :---------------------- | :---------------------------------------------------------------------------------------------- |
| HOST                    | [server.host](/config/server/host)                                                              |
| PORT                    | [server.port](/config/server/port)                                                              |
| HTTPS                   | [server.https](/config/server/https)                                                            |
| WDS_SOCKET_HOST         | [dev.client.host](/config/dev/client)                                                           |
| WDS_SOCKET_PATH         | [dev.client.path](/config/dev/client)                                                           |
| WDS_SOCKET_PORT         | [dev.client.port](/config/dev/client)                                                           |
| PUBLIC_URL              | [dev.assetPrefix](/config/dev/asset-prefix) / [output.assetPrefix](/config/output/asset-prefix) |
| BUILD_PATH              | [output.distPath](/config/output/dist-path)                                                     |
| GENERATE_SOURCEMAP      | [output.sourceMap](/config/output/source-map)                                                   |
| IMAGE_INLINE_SIZE_LIMIT | [output.dataUriLimit](/config/output/data-uri-limit)                                            |
| FAST_REFRESH            | [dev.hmr](/config/dev/hmr)                                                                      |
| TSC_COMPILE_ON_ERROR    | [@rsbuild/plugin-type-check](https://github.com/rspack-contrib/rsbuild-plugin-type-check)       |

Notas:

- A tabela acima nÃ£o cobre todas as configuraÃ§Ãµes do CRA, sinta-se Ã  vontade para adicionar mais.

## Compilar node_modules

Por padrÃ£o, o CRA usa Babel para compilar dependÃªncias em node_modules, mas o Rsbuild nÃ£o, para evitar a sobrecarga de desempenho e possÃ­veis erros de compilaÃ§Ã£o causados pela compilaÃ§Ã£o secundÃ¡ria.

Para lidar com problemas de compatibilidade de sintaxe causados por dependÃªncias em node_modules, vocÃª pode usar a configuraÃ§Ã£o [source.include](/config/source/include#compile-node_modules) para compilar node_modules.

```ts title="rsbuild.config.ts"
export default {
  source: {
    // Compila todos os arquivos JS e exclui core-js
    include: [{ not: /[\\/]core-js[\\/]/ }],
  },
};
```

## VariÃ¡veis de ambiente

O CRA injeta variÃ¡veis de ambiente que comeÃ§am com `REACT_APP_` no cÃ³digo do cliente por padrÃ£o, enquanto o Rsbuild injeta variÃ¡veis de ambiente que comeÃ§am com `PUBLIC_` por padrÃ£o (consulte [variÃ¡veis pÃºblicas](/guide/advanced/env-vars#public-variables)).

Para ser compatÃ­vel com o comportamento do CRA, vocÃª pode chamar manualmente o mÃ©todo [loadEnv](/api/javascript-api/core#loadenv) do Rsbuild para ler variÃ¡veis de ambiente que comeÃ§am com `REACT_APP_` e injetÃ¡-las no cÃ³digo do cliente atravÃ©s da configuraÃ§Ã£o [source.define](/config/source/define).

```ts title="rsbuild.config.ts"
import { defineConfig, loadEnv } from '@rsbuild/core';

const { publicVars } = loadEnv({ prefixes: ['REACT_APP_'] });

export default defineConfig({
  source: {
    define: publicVars,
  },
});
```

Observe que o CRA permite o acesso ao objeto `process.env` completo no cÃ³digo e tambÃ©m permite a desestruturaÃ§Ã£o de `process.env`. No entanto, o Rsbuild nÃ£o define o objeto `process.env` devido a preocupaÃ§Ãµes com o tamanho do bundle e seguranÃ§a.

```ts title="src/index.js"
// No CRA, vocÃª pode acessÃ¡-lo assim
const { PUBLIC_URL } = process.env;
console.log(PUBLIC_URL);
console.log(process.env);
```

No Rsbuild, vocÃª pode usar a configuraÃ§Ã£o [source.define](/config/source/define) para definir `process.env` e ler o `rawPublicVars` retornado pelo mÃ©todo `loadEnv` para permitir o uso acima:

```ts title="rsbuild.config.ts"
import { defineConfig, loadEnv } from '@rsbuild/core';

const { publicVars, rawPublicVars } = loadEnv({ prefixes: ['REACT_APP_'] });

export default defineConfig({
  source: {
    define: {
      ...publicVars,
      'process.env': JSON.stringify(rawPublicVars),
    },
  },
});
```

## Remover react-app-polyfill

O CRA fornece [react-app-polyfill](https://npmjs.com/package/react-app-polyfill) para injetar manualmente o cÃ³digo polyfill.

No projeto Rsbuild, vocÃª pode remover a dependÃªncia e o cÃ³digo relacionados ao react-app-polyfill, pois o Rsbuild lerÃ¡ automaticamente a configuraÃ§Ã£o do browserslist e permitirÃ¡ que vocÃª habilite a injeÃ§Ã£o de polyfill atravÃ©s da configuraÃ§Ã£o [output.polyfill](/config/output/polyfill).

1.  Remova a referÃªncia `react-app-polyfill`:

```ts title="src/index.js"
import 'react-app-polyfill/ie11'; // [!code --]
import 'react-app-polyfill/stable'; // [!code --]
```

2.  Configure [output.polyfill](/config/output/polyfill):

```ts title="rsbuild.config.ts"
export default {
  output: {
    polyfill: 'usage',
  },
};
```

> Leia [Compatibilidade do Navegador](/guide/advanced/browser-compatibility) para entender como o Rsbuild lida com polyfills.

## Configurar ESLint

O CRA uses ESLint to lint the code by default. Rsbuild does not include linting by default, but you can add a separate npm script to run ESLint in `package.json`.

First, install [eslint](https://eslint.org/) and [eslint-config-react-app](https://npmjs.com/package/eslint-config-react-app), you need to install ESLint v8 to keep consistent with CRA:

<PackageManagerTabs command="add eslint@8 eslint-config-react-app -D" />

Then, add the `lint` command in `package.json`, and confirm that the project contains an `eslintConfig` configuration or an independent ESLint configuration file:

```json title="package.json"
{
  "scripts": {
    "lint": "eslint src"
  },
  "eslintConfig": {
    "extends": ["react-app", "react-app/jest"]
  }
}
```

Then, you can use the `npm run lint` command to run ESLint.

### Executar ESLint durante a build

AlÃ©m de adicionar o comando `lint` em `package.json`, vocÃª tambÃ©m pode adicionar o plugin [@rsbuild/plugin-eslint](https://github.com/rspack-contrib/rsbuild-plugin-eslint) para manter o mesmo comportamento do CRA.

`@rsbuild/plugin-eslint` allows you to run ESLint during the build process.

```ts title="rsbuild.config.ts"
import { pluginEslint } from '@rsbuild/plugin-eslint';

export default {
  plugins: [pluginEslint()],
};
```

ApÃ³s registrar o plugin, o ESLint serÃ¡ executado automaticamente durante o desenvolvimento (`npm run dev`) e as builds de produÃ§Ã£o (`npm run build`). O plugin exibirÃ¡ avisos e erros do ESLint na saÃ­da do console.

:::warning
NÃ£o recomendamos usar o plugin `@rsbuild/plugin-eslint`, pois executar o ESLint durante o processo de build aumentarÃ¡ significativamente o tempo de build. Em vez disso, recomendamos usar um comando `lint` separado para executar as verificaÃ§Ãµes do ESLint.
:::

## Lendo jsconfig.json

Em projetos nÃ£o-TypeScript, o CRA suporta a leitura do campo `paths` em jsconfig.json como o alias de caminho.

Para usar este recurso no Rsbuild, consulte [Alias de Caminho - jsconfig.json](/guide/advanced/alias#jsconfigjson).

## MigraÃ§Ã£o CRACO

Se o seu projeto estiver usando [CRACO](https://craco.js.org) para sobrescrever a configuraÃ§Ã£o do CRA, vocÃª pode consultar a tabela abaixo para migraÃ§Ã£o:

| CRACO                                                                                           | Rsbuild                                                                                   |
| :---------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------- |
| [webpack.configure](https://craco.js.org/docs/configuration/webpack/#webpackconfigure)          | [tools.rspack](/config/tools/rspack)                                                      |
| [webpack.alias](https://craco.js.org/docs/configuration/webpack/#webpackalias)                  | [resolve.alias](/config/resolve/alias)                                                    |
| [webpack.plugins.add](https://craco.js.org/docs/configuration/webpack/#webpackplugins)          | [appendPlugins de tools.rspack](/config/tools/rspack#appendplugins)                       |
| [webpack.plugins.remove](https://craco.js.org/docs/configuration/webpack/#webpackpluginsremove) | [removePlugin de tools.rspack](/config/tools/rspack#removeplugin)                         |
| [style.modules](https://craco.js.org/docs/configuration/style/#stylemodules)                    | [output.cssModules](/config/output/css-modules)                                           |
| [style.css](https://craco.js.org/docs/configuration/style/#stylecss)                            | [tools.cssLoader](/config/tools/css-loader)                                               |
| [style.sass](https://craco.js.org/docs/configuration/style/#stylesass)                          | [Plugin Sass](/plugins/list/plugin-sass)                                                  |
| [style.postcss](https://craco.js.org/docs/configuration/style/#stylepostcss)                    | [tools.postcss](/config/tools/postcss)                                                    |
| [babel](https://craco.js.org/docs/configuration/babel/)                                         | [Plugin Babel](/plugins/list/plugin-babel)                                                |
| [typescript](https://craco.js.org/docs/configuration/typescript/)                               | [@rsbuild/plugin-type-check](https://github.com/rspack-contrib/rsbuild-plugin-type-check) |
| [devServer](https://craco.js.org/docs/configuration/devserver/)                                 | [configuraÃ§Ãµes do servidor](/config/index)                                                |

### Exemplo

Aqui estÃ¡ um exemplo de migraÃ§Ã£o de `webpack.configure` para `tools.rspack`:

- Antes da migraÃ§Ã£o:

```js title="craco.config.js"
const { whenDev } = require('@craco/craco');

module.exports = {
  webpack: {
    configure: {
      resolve: {
        mainFields: ['browser', 'module', 'main'],
      },
    },
    plugins: [...whenDev(() => [new MyWebpackPlugin()], [])],
  },
};
```

- ApÃ³s a migraÃ§Ã£o:

```ts title="rsbuild.config.ts"
export default {
  tools: {
    rspack: {
      resolve: {
        mainFields: ['browser', 'module', 'main'],
      },
      plugins:
        process.env.NODE_ENV === 'development' ? [new MyWebpackPlugin()] : [],
    },
  },
};
```

## Suplemento de conteÃºdo

O documento atual cobre apenas parte do processo de migraÃ§Ã£o. Se vocÃª encontrar conteÃºdo adequado para adicionar, sinta-se Ã  vontade para contribuir com a documentaÃ§Ã£o via pull request ğŸ¤.

> A documentaÃ§Ã£o para rsbuild can be found in the [rsbuild/website](https://github.com/web-infra-dev/rsbuild/tree/main/website) directory.
