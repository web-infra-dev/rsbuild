# Ativos estáticos

O Rsbuild suporta a importação de ativos estáticos, incluindo imagens, fontes, áudio e vídeo.

:::tip O que são Ativos Estáticos
Ativos estáticos são arquivos que fazem parte de uma aplicação web e não mudam, mesmo quando a aplicação está sendo usada. Exemplos de ativos estáticos incluem imagens, fontes, mídias, folhas de estilo e arquivos JavaScript. Esses ativos são tipicamente armazenados em um servidor web ou CDN, e entregues ao navegador do usuário quando a aplicação web é acessada. Como eles não mudam, os ativos estáticos podem ser armazenados em cache pelo navegador, o que ajuda a melhorar o desempenho da aplicação web.
:::

## Formato dos Ativos

Os seguintes são os formatos suportados pelo Rsbuild por padrão:

- **imagens**: png, jpg, jpeg, gif, svg, bmp, webp, ico, apng, avif, tif, tiff, jfif, pjpeg, pjp, cur.
- **fontes**: woff, woff2, eot, ttf, otf, ttc.
- **áudio**: mp3, wav, flac, aac, m4a, opus.
- **vídeo**: mp4, webm, ogg, mov.

Para importar ativos em outros formatos, consulte [Estender Tipos de Ativos](#extend-asset-types).

:::tip Imagens SVG
A imagem SVG é um caso especial. O Rsbuild suporta a conversão de SVG para componentes React, então o SVG é processado separadamente. Para detalhes, consulte [Plugin SVGR](/plugins/list/plugin-svgr).
:::

## Importar ativos em arquivo JS

Em arquivos JS, você pode importar ativos estáticos com caminhos relativos:

```tsx
// Importa a imagem logo.png no diretório static
import logo from './static/logo.png';

console.log(logo); // "/static/logo.[hash].png"

export default = () => <img src={logo} />;
```

A importação com [alias](/guide/advanced/alias) também está disponível:

```tsx
import logo from '@/static/logo.png';

console.log(logo); // "/static/logo.[hash].png"

export default = () => <img src={logo} />;
```

### Ativos URL

O Rsbuild suporta o uso de [URL](https://developer.mozilla.org/docs/Web/API/URL) nativo do JavaScript e [import.meta.url](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Operators/import.meta) para importar ativos estáticos.

```tsx
const logo = new URL('./static/logo.png', import.meta.url).href;

console.log(logo); // "/static/logo.[hash].png"

export default = () => <img src={logo} />;
```

Se você usar `new URL()` para referenciar arquivos `.js` ou `.ts`, eles serão tratados como ativos URL e não serão processados pelo `swc-loader` embutido do Rsbuild.

```tsx
// foo.ts manterá o conteúdo original e será gerado para o diretório dist
const fooTs = new URL('./foo.ts', import.meta.url).href;

console.log(fooTs); // "/static/foo.[hash].ts"
```

Da mesma forma, ao usar `new URL()` para referenciar arquivos `.css` ou `.scss`, eles serão tratados como ativos URL e não serão processados pelos loaders CSS embutidos do Rsbuild.

```tsx
// foo.css manterá o conteúdo original e será gerado para o diretório dist
const fooCss = new URL('./foo.css', import.meta.url).href;

console.log(fooCss); // "/static/foo.[hash].css"
```

## Importar ativos em arquivo CSS

Em arquivos CSS, você pode referenciar ativos estáticos em caminhos relativos:

```css
.logo {
  background-image: url('../static/logo.png');
}
```

Import with [alias](/guide/advanced/alias) are also supported:

```css
.logo {
  background-image: url('@/static/logo.png');
}
```

Se você quiser referenciar ativos estáticos em caminhos absolutos em arquivos CSS:

```css
@font-face {
  font-family: DingTalk;
  src: url('/image/font/foo.ttf');
}
```

Por padrão, o `css-loader` embutido no Rsbuild resolverá caminhos absolutos em `url()` e procurará os módulos especificados. Se você quiser pular a resolução de caminhos absolutos, você pode configurar [`tools.cssLoader`](/config/tools/css-loader#toolscssloader) para filtrar os caminhos especificados. Os caminhos filtrados são mantidos como estão no código.

```ts
export default {
  tools: {
    cssLoader: {
      url: {
        filter: (url) => {
          if (/\\/image\\/font/.test(url)) {
            return false;
          }
          return true;
        },
      },
    },
  },
};
```

## Ativos inline

O resultado da importação de ativos estáticos depende do tamanho do arquivo:

- Se o tamanho do arquivo for menor que 4KiB, ele será convertido para uma string base64 e incorporado ao código.
- Se o tamanho do arquivo for maior que 4KiB, uma URL será retornada, e o arquivo será emitido para o diretório de saída.

```js
import largeImage from './static/largeImage.png';
import smallImage from './static/smallImage.png';

console.log(largeImage); // "/static/largeImage.[hash].png"
console.log(smallImage); // "data:image/png;base64,iVBORw0KGgo..."
```

Adicionar a query `?url` garante que o ativo seja sempre carregado como um arquivo separado e retorne uma URL:

```js
import image from './static/image.png?url';

console.log(image); // "/static/image.[hash].png"
```

Adicionar a query `?inline` garante que o ativo seja sempre incorporado ao código, independentemente do tamanho do arquivo:

```js
import image from './static/image.png?inline';

console.log(image); // "data:image/png;base64,iVBORw0KGgo..."
```

Para uma introdução mais detalhada ao inlining de ativos, consulte o capítulo [Inlining de Ativos Estáticos](/guide/optimization/inline-assets).

## Importar como string

O Rsbuild suporta o uso do parâmetro de consulta `?raw` para importar o conteúdo bruto de ativos estáticos como uma string em JavaScript.

```ts
import rawSvg from './static/logo.svg?raw';

console.log(rawSvg); // O conteúdo bruto do arquivo SVG
```

O Rsbuild também suporta a importação do conteúdo bruto de arquivos JavaScript, TypeScript, e JSX através do parâmetro de consulta `?raw`.

```ts
import rawJs from './script1.js?raw';
import rawTs from './script1.ts?raw';
import rawJsx from './script1.jsx?raw';
import rawTsx from './script1.tsx?raw';

console.log(rawJs); // O conteúdo bruto do arquivo JS
console.log(rawTs); // O conteúdo bruto do arquivo TS
console.log(rawJsx); // O conteúdo bruto do arquivo JSX
console.log(rawTsx); // O conteúdo bruto do arquivo TSX
```

You can also use the `?raw` query parameter to import the raw content of CSS files, see [CSS](/guide/styling/css-usage#raw).

:::tip
O Rsbuild >= 1.3.0 suporta o parâmetro de consulta `?raw`, e >= 1.4.0 suporta a importação do conteúdo bruto de arquivos JS e TS.
:::

## Arquivos de saída

Quando ativos estáticos são importados, eles serão gerados para o diretório dist. Você pode:

- Modificar o nome do arquivo de saída através de [output.filename](/config/output/filename).
- Modificar o caminho de saída através de [output.distPath](/config/output/dist-path).

Please read [Arquivos de Saída](/guide/basic/output-files) for details.

## Prefixo URL

The URL returned after importing a asset will automatically include the path prefix:

- In development, using [dev.assetPrefix](/config/dev/asset-prefix) to set the path prefix.
- In production, using [output.assetPrefix](/config/output/asset-prefix) to set the path prefix.

For example, you can set `output.assetPrefix` to `https://example.com`:

```js
import logo from './static/logo.png';

console.log(logo); // "https://example.com/static/logo.[hash].png"
```

## Public folder

The public folder at the project root can be used to place some static assets. These assets will not be built by Rsbuild and can be directly referenced via URL.

- When you start the dev server, these assets will be served under the root [server.base](/config/server/base) path, default `/`.
- When you perform a production build, these assets will be copied to the [dist directory](/guide/basic/output-files).

For example, you can place files such as `robots.txt`, `manifest.json`, or `favicon.ico` in the public folder.

### How to reference

You can reference files in the `public` directory via a URL.

For example, in an HTML template, the `./public/favicon.ico` file can be referenced as `/favicon.ico`, [BASE_URL](/guide/advanced/env-vars#processenvpublic_base_path) is the base path of the server.

```html title="index.html"
<link rel="icon" href="<%= process.env.BASE_URL %>/favicon.ico" />
```

### Notes

Here are some notes on using the `public` folder:

- When referencing assets in the public folder via URL, please use absolute paths instead of relative paths to ensure that the assets can be accessed correctly after deployment.

```html title="src/index.html"
<!-- Wrong -->
<link rel="icon" href="../public/favicon.ico" />

<!-- Correct -->
<link rel="icon" href="/favicon.ico" />
```

- Please avoid importing files from the public directory into the source code. The correct approach is to reference them by URL. You can place static assets imported into the source code in the `/src/assets` directory.

```js title="src/index.js"
// Wrong
import logo from '../public/logo.png';

// Correct
import logo from './assets/logo.png';
```

- During the production build, the files in public folder will be copied to the output folder (default is `dist`). Please be careful to avoid name conflicts with the output files. When files in the `public` folder have the same name as outputs, the outputs have higher priority and will overwrite the files with the same name in the `public` folder. This feature can be disabled by setting [server.publicDir.copyOnBuild](/config/server/public-dir) to `false`.

### Comportamento personalizado

O Rsbuild fornece a opção [server.publicDir](/config/server/public-dir) que pode ser usada para personalizar o nome e o comportamento da pasta pública, bem como para desabilitá-la.

```ts title="rsbuild.config.ts"
export default {
  server: {
    publicDir: false,
  },
};
```

## Declaração de tipo

When you import static assets in TypeScript code, TypeScript may prompt that the module is missing a type definition:

```
TS2307: Cannot find module './logo.png' or its corresponding type declarations.
```

Para corrigir isso, você precisa adicionar um arquivo de declaração de tipo para os ativos estáticos. Crie um arquivo `src/env.d.ts` e adicione a declaração de tipo correspondente.

- Método 1: Se o pacote `@rsbuild/core` estiver instalado, você pode referenciar os [tipos predefinidos](/guide/basic/typescript#preset-types) fornecidos por `@rsbuild/core`:

```ts
/// <reference types="@rsbuild/core/types" />
```

- Método 2: Adicione manualmente as declarações de tipo necessárias:

```ts title="src/env.d.ts"
// Tomando imagens png como exemplo
declare module '*.png' {
  const content: string;
  export default content;
}
```

## Extend asset types

If the built-in asset types in Rsbuild cannot meet your requirements, you can extend additional static asset types in the following ways.

### Use `source.assetsInclude`

By using the [source.assetsInclude](/config/source/assets-include) config, you can specify additional file types to be treated as static assets.

```ts title="rsbuild.config.ts"
export default {
  source: {
    assetsInclude: /\.pdf$/,
  },
};
```

After adding the above configuration, you can import `*.pdf` files in your code, for example:

```js
import myFile from './static/myFile.pdf';

console.log(myFile); // "/static/myFile.[hash].pdf"
```

### Use `tools.rspack`

You can modify the built-in Rspack configuration and add custom static assets handling rules via [tools.rspack](/config/tools/rspack).

For example, to treat `*.pdf` files as assets and output them to the dist directory, you can add the following configuration:

```ts title="rsbuild.config.ts"
export default {
  tools: {
    rspack(config, { addRules }) {
      addRules([
        {
          test: /\.pdf$/,
          // converts asset to a separate file and exports the URL address.
          type: 'asset/resource',
        },
      ]);
    },
  },
};
```

For more information about asset modules, please refer to [Rspack - Asset modules](https://rspack.rs/guide/features/asset-module).

### Related configurations

Extended static asset types will be affected by the following configurations:

- [output.filename.assets](/config/output/filename): Set the name of extended static assets.
- [output.distPath.assets](/config/output/dist-path): Set the output directory of extended static assets.
- [output.dataUriLimit.assets](/config/output/data-uri-limit): Set the threshold of inlining for extended static assets.

## Custom rules

In some scenarios, you may need to bypass the built-in assets processing rules of Rsbuild and add some custom rules.

Taking PNG image as an example, you need to:

1. Modify the built-in Rspack config via [tools.bundlerChain](/config/tools/bundler-chain) to exclude `.png` files using the `exclude` method.
2. Add custom asset processing rules via [tools.rspack](/config/tools/rspack).

```ts title="rsbuild.config.ts"
export default {
  tools: {
    bundlerChain(chain, { CHAIN_ID }) {
      chain.module
        // Use `CHAIN_ID.RULE.IMAGE` to locate the built-in image rule
        .rule(CHAIN_ID.RULE.IMAGE)
        .exclude.add(/\\.png$/);
    },
    rspack(config, { addRules }) {
      addRules([
        {
          test: /\\.png$/,
          // Add a custom loader to handle png images
          loader: 'custom-png-loader',
        },
      ]);
    },
  },
};
```

## Image format

When using image assets, you can choose a appropriate image format according to the pros and cons in the table below.

| Format | Pros                                                                                                      | Cons                                                                                | Scenarios                                                                                                                                              |
| ------ | --------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| PNG    | Lossless compression, no loss of picture details, no distortion, support for translucency                 | Not suitable for pictures with complex color tables                                 | Suitable for pictures with few colors and well-defined borders, suitable for logos, icons, transparent images and other scenes                         |
| JPG    | Rich colors                                                                                               | Lossy compression, which will cause image distortion, does not support transparency | Suitable for pictures with a large number of colors, gradients, and overly complex pictures, suitable for portrait photos, landscapes and other scenes |
| WebP   | Supports both lossy and lossless compression, supports transparency, and is much smaller than PNG and JPG | iOS compatibility is not good                                                       | Pixel images of almost any scene, and the hosting environment that supports WebP, should prefer WebP image format                                      |
| SVG    | Lossless format, no distortion, supports transparency                                                     | Not suitable for complex graphics                                                   | Suitable for vector graphics, suitable for icons                                                                                                       |
