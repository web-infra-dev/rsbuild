// Rstest Snapshot v1

exports[`plugin-swc > should add browserslist 1`] = `
[
  {
    "entry": {
      "main": [
        "./src/index.js",
      ],
    },
    "module": {
      "rules": [
        {
          "dependency": {
            "not": "url",
          },
          "include": [
            {
              "not": /\\[\\\\\\\\/\\]node_modules\\[\\\\\\\\/\\]/,
            },
            /\\\\\\.\\(\\?:ts\\|tsx\\|jsx\\|mts\\|cts\\)\\$/,
          ],
          "resourceQuery": {
            "not": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          },
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "javascript/auto",
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "mode": undefined,
                  "targets": [
                    "chrome 98",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                },
              },
            },
          ],
        },
        {
          "resourceQuery": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "asset/source",
        },
        {
          "mimetype": {
            "or": [
              "text/javascript",
              "application/javascript",
            ],
          },
          "resolve": {
            "fullySpecified": false,
          },
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "mode": undefined,
                  "targets": [
                    "chrome 98",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                },
              },
            },
          ],
        },
      ],
    },
    "plugins": [
      {
        "name": "RsbuildCorePlugin",
      },
    ],
  },
]
`;

exports[`plugin-swc > should add pluginImport 1`] = `
[
  {
    "entry": {
      "main": [
        "./src/index.js",
      ],
    },
    "module": {
      "rules": [
        {
          "dependency": {
            "not": "url",
          },
          "include": [
            {
              "not": /\\[\\\\\\\\/\\]node_modules\\[\\\\\\\\/\\]/,
            },
            /\\\\\\.\\(\\?:ts\\|tsx\\|jsx\\|mts\\|cts\\)\\$/,
          ],
          "resourceQuery": {
            "not": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          },
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "javascript/auto",
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "mode": undefined,
                  "targets": [
                    "chrome >= 87",
                    "edge >= 88",
                    "firefox >= 78",
                    "safari >= 14",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                  "import": [
                    {
                      "libraryName": "foo",
                    },
                  ],
                },
              },
            },
          ],
        },
        {
          "resourceQuery": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "asset/source",
        },
        {
          "mimetype": {
            "or": [
              "text/javascript",
              "application/javascript",
            ],
          },
          "resolve": {
            "fullySpecified": false,
          },
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "mode": undefined,
                  "targets": [
                    "chrome >= 87",
                    "edge >= 88",
                    "firefox >= 78",
                    "safari >= 14",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                  "import": [
                    {
                      "libraryName": "foo",
                    },
                  ],
                },
              },
            },
          ],
        },
      ],
    },
    "plugins": [
      {
        "name": "RsbuildCorePlugin",
      },
    ],
  },
]
`;

exports[`plugin-swc > should allow to use \`tools.swc\` to be function type 1`] = `
[
  {
    "dependency": {
      "not": "url",
    },
    "include": [
      {
        "not": /\\[\\\\\\\\/\\]node_modules\\[\\\\\\\\/\\]/,
      },
      /\\\\\\.\\(\\?:ts\\|tsx\\|jsx\\|mts\\|cts\\)\\$/,
    ],
    "resourceQuery": {
      "not": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
    },
    "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
    "type": "javascript/auto",
    "use": [
      {
        "loader": "builtin:swc-loader",
        "options": {
          "jsc": {
            "externalHelpers": false,
          },
        },
      },
    ],
  },
  {
    "resourceQuery": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
    "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
    "type": "asset/source",
  },
  {
    "mimetype": {
      "or": [
        "text/javascript",
        "application/javascript",
      ],
    },
    "resolve": {
      "fullySpecified": false,
    },
    "use": [
      {
        "loader": "builtin:swc-loader",
        "options": {
          "jsc": {
            "externalHelpers": false,
          },
        },
      },
    ],
  },
]
`;

exports[`plugin-swc > should allow to use \`tools.swc\` to configure swc-loader options 1`] = `
[
  {
    "dependency": {
      "not": "url",
    },
    "include": [
      {
        "not": /\\[\\\\\\\\/\\]node_modules\\[\\\\\\\\/\\]/,
      },
      /\\\\\\.\\(\\?:ts\\|tsx\\|jsx\\|mts\\|cts\\)\\$/,
    ],
    "resourceQuery": {
      "not": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
    },
    "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
    "type": "javascript/auto",
    "use": [
      {
        "loader": "builtin:swc-loader",
        "options": {
          "env": {
            "mode": undefined,
            "targets": [
              "chrome >= 87",
              "edge >= 88",
              "firefox >= 78",
              "safari >= 14",
            ],
          },
          "isModule": "unknown",
          "jsc": {
            "experimental": {
              "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
              "keepImportAttributes": true,
            },
            "externalHelpers": false,
            "output": {
              "charset": "utf8",
            },
            "parser": {
              "decorators": true,
              "syntax": "typescript",
              "tsx": false,
            },
            "transform": {
              "decoratorVersion": "2022-03",
              "legacyDecorator": false,
            },
          },
          "rspackExperiments": {
            "collectTypeScriptInfo": {
              "exportedEnum": false,
              "typeExports": true,
            },
          },
        },
      },
    ],
  },
  {
    "resourceQuery": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
    "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
    "type": "asset/source",
  },
  {
    "mimetype": {
      "or": [
        "text/javascript",
        "application/javascript",
      ],
    },
    "resolve": {
      "fullySpecified": false,
    },
    "use": [
      {
        "loader": "builtin:swc-loader",
        "options": {
          "env": {
            "mode": undefined,
            "targets": [
              "chrome >= 87",
              "edge >= 88",
              "firefox >= 78",
              "safari >= 14",
            ],
          },
          "isModule": "unknown",
          "jsc": {
            "experimental": {
              "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
              "keepImportAttributes": true,
            },
            "externalHelpers": false,
            "output": {
              "charset": "utf8",
            },
            "parser": {
              "decorators": true,
              "syntax": "typescript",
              "tsx": false,
            },
            "transform": {
              "decoratorVersion": "2022-03",
              "legacyDecorator": false,
            },
          },
          "rspackExperiments": {
            "collectTypeScriptInfo": {
              "exportedEnum": false,
              "typeExports": true,
            },
          },
        },
      },
    ],
  },
]
`;

exports[`plugin-swc > should apply environment config correctly 1`] = `
[
  {
    "dependency": {
      "not": "url",
    },
    "exclude": [
      "src/example",
    ],
    "include": [
      {
        "not": /\\[\\\\\\\\/\\]node_modules\\[\\\\\\\\/\\]/,
      },
      /\\\\\\.\\(\\?:ts\\|tsx\\|jsx\\|mts\\|cts\\)\\$/,
    ],
    "resolve": {
      "alias": {
        "core-js": "<ROOT>/node_modules/<PNPM_INNER>/core-js",
      },
    },
    "resourceQuery": {
      "not": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
    },
    "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
    "type": "javascript/auto",
    "use": [
      {
        "loader": "builtin:swc-loader",
        "options": {
          "env": {
            "coreJs": "3.47",
            "mode": "usage",
            "shippedProposals": true,
            "targets": [
              "chrome >= 87",
              "edge >= 88",
              "firefox >= 78",
              "safari >= 14",
            ],
          },
          "isModule": "unknown",
          "jsc": {
            "experimental": {
              "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
              "keepImportAttributes": true,
            },
            "externalHelpers": true,
            "output": {
              "charset": "utf8",
            },
            "parser": {
              "decorators": true,
              "syntax": "typescript",
              "tsx": false,
            },
            "transform": {
              "decoratorVersion": "2022-03",
              "legacyDecorator": false,
            },
          },
          "rspackExperiments": {
            "collectTypeScriptInfo": {
              "exportedEnum": false,
              "typeExports": true,
            },
            "import": [
              {
                "libraryName": "foo",
              },
            ],
          },
        },
      },
    ],
  },
  {
    "resourceQuery": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
    "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
    "type": "asset/source",
  },
  {
    "mimetype": {
      "or": [
        "text/javascript",
        "application/javascript",
      ],
    },
    "resolve": {
      "alias": {
        "core-js": "<ROOT>/node_modules/<PNPM_INNER>/core-js",
      },
      "fullySpecified": false,
    },
    "use": [
      {
        "loader": "builtin:swc-loader",
        "options": {
          "env": {
            "coreJs": "3.47",
            "mode": "usage",
            "shippedProposals": true,
            "targets": [
              "chrome >= 87",
              "edge >= 88",
              "firefox >= 78",
              "safari >= 14",
            ],
          },
          "isModule": "unknown",
          "jsc": {
            "experimental": {
              "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
              "keepImportAttributes": true,
            },
            "externalHelpers": true,
            "output": {
              "charset": "utf8",
            },
            "parser": {
              "decorators": true,
              "syntax": "typescript",
              "tsx": false,
            },
            "transform": {
              "decoratorVersion": "2022-03",
              "legacyDecorator": false,
            },
          },
          "rspackExperiments": {
            "collectTypeScriptInfo": {
              "exportedEnum": false,
              "typeExports": true,
            },
            "import": [
              {
                "libraryName": "foo",
              },
            ],
          },
        },
      },
    ],
  },
]
`;

exports[`plugin-swc > should apply environment config correctly 2`] = `
[
  {
    "dependency": {
      "not": "url",
    },
    "exclude": [
      "src/example1",
    ],
    "include": [
      {
        "not": /\\[\\\\\\\\/\\]node_modules\\[\\\\\\\\/\\]/,
      },
      /\\\\\\.\\(\\?:ts\\|tsx\\|jsx\\|mts\\|cts\\)\\$/,
    ],
    "resourceQuery": {
      "not": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
    },
    "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
    "type": "javascript/auto",
    "use": [
      {
        "loader": "builtin:swc-loader",
        "options": {
          "env": {
            "targets": [
              "node >= 16",
            ],
          },
          "isModule": "unknown",
          "jsc": {
            "experimental": {
              "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
              "keepImportAttributes": true,
            },
            "externalHelpers": true,
            "output": {
              "charset": "utf8",
            },
            "parser": {
              "decorators": true,
              "syntax": "typescript",
              "tsx": false,
            },
            "transform": {
              "decoratorVersion": "2022-03",
              "legacyDecorator": false,
            },
          },
          "rspackExperiments": {
            "collectTypeScriptInfo": {
              "exportedEnum": false,
              "typeExports": true,
            },
            "import": [
              {
                "libraryName": "bar",
              },
            ],
          },
        },
      },
    ],
  },
  {
    "resourceQuery": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
    "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
    "type": "asset/source",
  },
  {
    "mimetype": {
      "or": [
        "text/javascript",
        "application/javascript",
      ],
    },
    "resolve": {
      "fullySpecified": false,
    },
    "use": [
      {
        "loader": "builtin:swc-loader",
        "options": {
          "env": {
            "targets": [
              "node >= 16",
            ],
          },
          "isModule": "unknown",
          "jsc": {
            "experimental": {
              "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
              "keepImportAttributes": true,
            },
            "externalHelpers": true,
            "output": {
              "charset": "utf8",
            },
            "parser": {
              "decorators": true,
              "syntax": "typescript",
              "tsx": false,
            },
            "transform": {
              "decoratorVersion": "2022-03",
              "legacyDecorator": false,
            },
          },
          "rspackExperiments": {
            "collectTypeScriptInfo": {
              "exportedEnum": false,
              "typeExports": true,
            },
            "import": [
              {
                "libraryName": "bar",
              },
            ],
          },
        },
      },
    ],
  },
]
`;

exports[`plugin-swc > should apply pluginImport correctly when ConfigChain 1`] = `
[
  {
    "entry": {
      "main": [
        "./src/index.js",
      ],
    },
    "module": {
      "rules": [
        {
          "dependency": {
            "not": "url",
          },
          "include": [
            {
              "not": /\\[\\\\\\\\/\\]node_modules\\[\\\\\\\\/\\]/,
            },
            /\\\\\\.\\(\\?:ts\\|tsx\\|jsx\\|mts\\|cts\\)\\$/,
          ],
          "resourceQuery": {
            "not": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          },
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "javascript/auto",
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "mode": undefined,
                  "targets": [
                    "chrome >= 87",
                    "edge >= 88",
                    "firefox >= 78",
                    "safari >= 14",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                  "import": [
                    {
                      "libraryName": "foo",
                    },
                    {
                      "libraryName": "bar",
                    },
                  ],
                },
              },
            },
          ],
        },
        {
          "resourceQuery": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "asset/source",
        },
        {
          "mimetype": {
            "or": [
              "text/javascript",
              "application/javascript",
            ],
          },
          "resolve": {
            "fullySpecified": false,
          },
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "mode": undefined,
                  "targets": [
                    "chrome >= 87",
                    "edge >= 88",
                    "firefox >= 78",
                    "safari >= 14",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                  "import": [
                    {
                      "libraryName": "foo",
                    },
                    {
                      "libraryName": "bar",
                    },
                  ],
                },
              },
            },
          ],
        },
      ],
    },
    "plugins": [
      {
        "name": "RsbuildCorePlugin",
      },
    ],
  },
]
`;

exports[`plugin-swc > should disable pluginImport when return undefined 1`] = `
[
  {
    "entry": {
      "main": [
        "./src/index.js",
      ],
    },
    "module": {
      "rules": [
        {
          "dependency": {
            "not": "url",
          },
          "include": [
            {
              "not": /\\[\\\\\\\\/\\]node_modules\\[\\\\\\\\/\\]/,
            },
            /\\\\\\.\\(\\?:ts\\|tsx\\|jsx\\|mts\\|cts\\)\\$/,
          ],
          "resourceQuery": {
            "not": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          },
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "javascript/auto",
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "mode": undefined,
                  "targets": [
                    "chrome >= 87",
                    "edge >= 88",
                    "firefox >= 78",
                    "safari >= 14",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                },
              },
            },
          ],
        },
        {
          "resourceQuery": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "asset/source",
        },
        {
          "mimetype": {
            "or": [
              "text/javascript",
              "application/javascript",
            ],
          },
          "resolve": {
            "fullySpecified": false,
          },
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "mode": undefined,
                  "targets": [
                    "chrome >= 87",
                    "edge >= 88",
                    "firefox >= 78",
                    "safari >= 14",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                },
              },
            },
          ],
        },
      ],
    },
    "plugins": [
      {
        "name": "RsbuildCorePlugin",
      },
    ],
  },
]
`;

exports[`plugin-swc > should disable preset_env in target other than web 1`] = `
[
  {
    "entry": {
      "main": [
        "./src/index.js",
      ],
    },
    "module": {
      "rules": [
        {
          "dependency": {
            "not": "url",
          },
          "include": [
            {
              "not": /\\[\\\\\\\\/\\]node_modules\\[\\\\\\\\/\\]/,
            },
            /\\\\\\.\\(\\?:ts\\|tsx\\|jsx\\|mts\\|cts\\)\\$/,
          ],
          "resourceQuery": {
            "not": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          },
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "javascript/auto",
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "targets": [
                    "node >= 16",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                },
              },
            },
          ],
        },
        {
          "resourceQuery": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "asset/source",
        },
        {
          "mimetype": {
            "or": [
              "text/javascript",
              "application/javascript",
            ],
          },
          "resolve": {
            "fullySpecified": false,
          },
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "targets": [
                    "node >= 16",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                },
              },
            },
          ],
        },
      ],
    },
    "plugins": [
      {
        "name": "RsbuildCorePlugin",
      },
    ],
  },
]
`;

exports[`plugin-swc > should disable preset_env mode 1`] = `
[
  {
    "entry": {
      "main": [
        "./src/index.js",
      ],
    },
    "module": {
      "rules": [
        {
          "dependency": {
            "not": "url",
          },
          "include": [
            {
              "not": /\\[\\\\\\\\/\\]node_modules\\[\\\\\\\\/\\]/,
            },
            /\\\\\\.\\(\\?:ts\\|tsx\\|jsx\\|mts\\|cts\\)\\$/,
          ],
          "resourceQuery": {
            "not": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          },
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "javascript/auto",
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "mode": undefined,
                  "targets": [
                    "chrome >= 87",
                    "edge >= 88",
                    "firefox >= 78",
                    "safari >= 14",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                },
              },
            },
          ],
        },
        {
          "resourceQuery": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "asset/source",
        },
        {
          "mimetype": {
            "or": [
              "text/javascript",
              "application/javascript",
            ],
          },
          "resolve": {
            "fullySpecified": false,
          },
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "mode": undefined,
                  "targets": [
                    "chrome >= 87",
                    "edge >= 88",
                    "firefox >= 78",
                    "safari >= 14",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                },
              },
            },
          ],
        },
      ],
    },
    "plugins": [
      {
        "name": "RsbuildCorePlugin",
      },
    ],
  },
]
`;

exports[`plugin-swc > should enable entry mode preset_env 1`] = `
[
  {
    "entry": {
      "main": [
        "data:text/javascript,import%20%22core-js%22%3B",
        "./src/index.js",
      ],
    },
    "module": {
      "rules": [
        {
          "dependency": {
            "not": "url",
          },
          "include": [
            {
              "not": /\\[\\\\\\\\/\\]node_modules\\[\\\\\\\\/\\]/,
            },
            /\\\\\\.\\(\\?:ts\\|tsx\\|jsx\\|mts\\|cts\\)\\$/,
          ],
          "resolve": {
            "alias": {
              "core-js": "<ROOT>/node_modules/<PNPM_INNER>/core-js",
            },
          },
          "resourceQuery": {
            "not": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          },
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "javascript/auto",
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "coreJs": "3.47",
                  "mode": "entry",
                  "targets": [
                    "chrome >= 87",
                    "edge >= 88",
                    "firefox >= 78",
                    "safari >= 14",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                },
              },
            },
          ],
        },
        {
          "resourceQuery": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "asset/source",
        },
        {
          "mimetype": {
            "or": [
              "text/javascript",
              "application/javascript",
            ],
          },
          "resolve": {
            "alias": {
              "core-js": "<ROOT>/node_modules/<PNPM_INNER>/core-js",
            },
            "fullySpecified": false,
          },
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "coreJs": "3.47",
                  "mode": "entry",
                  "targets": [
                    "chrome >= 87",
                    "edge >= 88",
                    "firefox >= 78",
                    "safari >= 14",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                },
              },
            },
          ],
        },
      ],
    },
    "plugins": [
      {
        "name": "RsbuildCorePlugin",
      },
    ],
  },
]
`;

exports[`plugin-swc > should enable usage mode preset_env 1`] = `
[
  {
    "entry": {
      "main": [
        "./src/index.js",
      ],
    },
    "module": {
      "rules": [
        {
          "dependency": {
            "not": "url",
          },
          "include": [
            {
              "not": /\\[\\\\\\\\/\\]node_modules\\[\\\\\\\\/\\]/,
            },
            /\\\\\\.\\(\\?:ts\\|tsx\\|jsx\\|mts\\|cts\\)\\$/,
          ],
          "resolve": {
            "alias": {
              "core-js": "<ROOT>/node_modules/<PNPM_INNER>/core-js",
            },
          },
          "resourceQuery": {
            "not": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          },
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "javascript/auto",
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "coreJs": "3.47",
                  "mode": "usage",
                  "shippedProposals": true,
                  "targets": [
                    "chrome >= 87",
                    "edge >= 88",
                    "firefox >= 78",
                    "safari >= 14",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                },
              },
            },
          ],
        },
        {
          "resourceQuery": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "asset/source",
        },
        {
          "mimetype": {
            "or": [
              "text/javascript",
              "application/javascript",
            ],
          },
          "resolve": {
            "alias": {
              "core-js": "<ROOT>/node_modules/<PNPM_INNER>/core-js",
            },
            "fullySpecified": false,
          },
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "coreJs": "3.47",
                  "mode": "usage",
                  "shippedProposals": true,
                  "targets": [
                    "chrome >= 87",
                    "edge >= 88",
                    "firefox >= 78",
                    "safari >= 14",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                },
              },
            },
          ],
        },
      ],
    },
    "plugins": [
      {
        "name": "RsbuildCorePlugin",
      },
    ],
  },
]
`;

exports[`plugin-swc > should has correct core-js 1`] = `
[
  {
    "entry": {
      "main": [
        "data:text/javascript,import%20%22core-js%22%3B",
        "./src/index.js",
      ],
    },
    "module": {
      "rules": [
        {
          "dependency": {
            "not": "url",
          },
          "include": [
            {
              "not": /\\[\\\\\\\\/\\]node_modules\\[\\\\\\\\/\\]/,
            },
            /\\\\\\.\\(\\?:ts\\|tsx\\|jsx\\|mts\\|cts\\)\\$/,
          ],
          "resolve": {
            "alias": {
              "core-js": "<ROOT>/node_modules/<PNPM_INNER>/core-js",
            },
          },
          "resourceQuery": {
            "not": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          },
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "javascript/auto",
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "coreJs": "3.47",
                  "mode": "entry",
                  "targets": [
                    "chrome >= 87",
                    "edge >= 88",
                    "firefox >= 78",
                    "safari >= 14",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                },
              },
            },
          ],
        },
        {
          "resourceQuery": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "asset/source",
        },
        {
          "mimetype": {
            "or": [
              "text/javascript",
              "application/javascript",
            ],
          },
          "resolve": {
            "alias": {
              "core-js": "<ROOT>/node_modules/<PNPM_INNER>/core-js",
            },
            "fullySpecified": false,
          },
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "coreJs": "3.47",
                  "mode": "entry",
                  "targets": [
                    "chrome >= 87",
                    "edge >= 88",
                    "firefox >= 78",
                    "safari >= 14",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                },
              },
            },
          ],
        },
      ],
    },
    "plugins": [
      {
        "name": "RsbuildCorePlugin",
      },
    ],
  },
]
`;

exports[`plugin-swc > should has correct core-js 2`] = `
[
  {
    "entry": {
      "main": [
        "./src/index.js",
      ],
    },
    "module": {
      "rules": [
        {
          "dependency": {
            "not": "url",
          },
          "include": [
            {
              "not": /\\[\\\\\\\\/\\]node_modules\\[\\\\\\\\/\\]/,
            },
            /\\\\\\.\\(\\?:ts\\|tsx\\|jsx\\|mts\\|cts\\)\\$/,
          ],
          "resourceQuery": {
            "not": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          },
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "javascript/auto",
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "targets": [
                    "node >= 16",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                },
              },
            },
          ],
        },
        {
          "resourceQuery": /\\[\\?&\\]raw\\(\\?:&\\|=\\|\\$\\)/,
          "test": /\\\\\\.\\(\\?:js\\|jsx\\|mjs\\|cjs\\|ts\\|tsx\\|mts\\|cts\\)\\$/,
          "type": "asset/source",
        },
        {
          "mimetype": {
            "or": [
              "text/javascript",
              "application/javascript",
            ],
          },
          "resolve": {
            "fullySpecified": false,
          },
          "use": [
            {
              "loader": "builtin:swc-loader",
              "options": {
                "env": {
                  "targets": [
                    "node >= 16",
                  ],
                },
                "isModule": "unknown",
                "jsc": {
                  "experimental": {
                    "cacheRoot": "<ROOT>/packages/core/tests/node_modules/.cache/.swc",
                    "keepImportAttributes": true,
                  },
                  "externalHelpers": true,
                  "output": {
                    "charset": "utf8",
                  },
                  "parser": {
                    "decorators": true,
                    "syntax": "typescript",
                    "tsx": false,
                  },
                  "transform": {
                    "decoratorVersion": "2022-03",
                    "legacyDecorator": false,
                  },
                },
                "rspackExperiments": {
                  "collectTypeScriptInfo": {
                    "exportedEnum": false,
                    "typeExports": true,
                  },
                },
              },
            },
          ],
        },
      ],
    },
    "plugins": [
      {
        "name": "RsbuildCorePlugin",
      },
    ],
  },
]
`;
